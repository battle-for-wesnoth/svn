#!/usr/bin/perl
# codecomp
# compare list of codepoints with a baseline list

while (<>) {
#    next unless /codepoints=\"(.*)\"/;
#    push @cs, [ split /,/, $1 ];
    push @cs, [ split /,/ ];
    push @fs, $ARGV;
}
# hardcode DejaVu codepoint list for now, as baseline
# use codeextract to update, this list is from DejaVu 2.2
@c = split /,/, '32-126,160-745,748-750,755,759,768-846,849-851,855-856,860-861,864-866,884-885,890-894,900-906,908,910-929,931-974,976-1273,1280-1297,1329-1366,1369-1375,1377-1415,1417-1418,1456-1465,1467-1475,1478-1479,1488-1514,1520-1522,1548,1557,1563,1567,1569-1594,1600-1621,1626,1632-1647,1652,1657-1671,1681-1682,1685,1688,1697,1700,1702,1705,1711,1717,1722,1727,1734,1740,1742,1749,1776-1785,3647,3713-3714,3716,3719-3720,3722,3725,3732-3735,3737-3743,3745-3747,3749,3751,3754-3755,3757-3769,3771-3773,3776-3780,3782,3784-3789,3804-3805,7424-7444,7446-7459,7462-7470,7472-7530,7543-7544,7547,7557,7579-7615,7680-7835,7840-7929,7936-7957,7960-7965,7968-8005,8008-8013,8016-8023,8025,8027,8029,8031-8061,8064-8116,8118-8132,8134-8147,8150-8155,8157-8175,8178-8180,8182-8190,8192-8231,8239-8286,8304-8305,8308-8334,8336-8340,8352-8373,8400-8401,8406-8407,8448,8450-8454,8457,8461-8463,8465,8467,8469-8474,8476-8478,8480-8482,8484,8486-8487,8490-8491,8494,8498,8500-8501,8507-8512,8517-8521,8523,8531-8580,8592-8765,8769-8879,8882-8893,8896-8897,8900-8902,8904-8909,8918-8941,8946-8959,8962,8966,8968-8971,8976-8977,8984-8985,8992-8993,8997,9000-9002,9085,9115-9134,9167,9250-9251,9312-9321,9472-9884,9888-9905,9985-9988,9990-9993,9996-10023,10025-10059,10061,10063-10066,10070,10072-10078,10081-10132,10136-10159,10161-10175,10208,10216-10219,10240-10495,10702-10709,10731,10752-10754,10764-10780,10877-10912,10926-10938,11001-11002,11026-11034,11360-11372,11380-11383,57344-57373,61440-61441,61960,61962,61973-61975,61978-61979,62047,62917,63172-63176,63185,63188,64256-64262,64275-64279,64285,64287-64288,64297-64316,64318,64320-64321,64323-64324,64326-64334,64338-64385,64394-64405,64414-64415,64473-64474,64488-64489,64508-64511,65136-65140,65142-65276,65279,65533';

#foreach $d ( @cs ) {
#    print join(',', @$d), "\n";
#}

foreach $d ( @cs ) {
    $i = 0; $j = 0;
    my @e;
    # compare @{$d} and @c, want to find all intersections
    while ( $c[$i] and $d->[$j] ) {
	($a,$b) = split /-/, $c[$i];
	$b = $a unless $b;
	($x,$y) = split /-/, $d->[$j];
	$y = $x unless $y;
	if ( $x <= $b and $a <= $y ) { # intersection
	    my $min = ($a > $x) ? $a : $x;
	    my $max = ($b < $y) ? $b : $y;
	    push @e, $min . (($min != $max) ? "-$max" : '');
	}
	++$i if $b <= $y;
	++$j if $b >= $y;
	# if $b == $y advance both
    }
    push @es, [ @e ];
}
$i = 0;
while ( $es[$i] ) {
# if *equal* is flagged, then this codepoint list is covered by DejaVu
    print "*equal* " if join(',', @{$es[$i]}) eq join(',', @{$cs[$i]});
    print $fs[$i], ' = ', join(',', @{$es[$i]}), "\n";
    ++$i;
}

