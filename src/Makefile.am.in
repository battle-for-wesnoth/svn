AUTOMAKE_OPTIONS = subdir-objects

bin_PROGRAMS =

if GAME
bin_PROGRAMS += wesnoth
endif

if SERVER
bin_PROGRAMS += wesnothd
endif

if CAMPAIGNSERVER
bin_PROGRAMS += campaignd
endif

if TOOLS
bin_PROGRAMS += exploder cutter
endif

if EDITOR
bin_PROGRAMS += wesnoth_editor
endif

pkgdatadir=$(datadir)/@DATADIR@

#############################################################################
#    Wesnoth                                                                #
#############################################################################

wesnoth_SOURCES = @wesnoth_common_sources@ @wesnoth_sources@

#############################################################################
#    Editor                                                                 #
#############################################################################

wesnoth_editor_SOURCES = @wesnoth_common_sources@ @wesnoth_editor_sources@

#############################################################################
#    Wesnothd Server                                                        #
#############################################################################

wesnothd_SOURCES = \
	server/game.cpp \
	server/input_stream.cpp \
	server/metrics.cpp \
	server/player.cpp \
	server/server.cpp \
	config.cpp \
	filesystem.cpp \
	game_config.cpp \
	gettext.cpp \
	log.cpp \
	network.cpp \
	network_worker.cpp \
	thread.cpp \
	tstring.cpp \
	serialization/binary_wml.cpp \
	serialization/parser.cpp \
	serialization/string_utils.cpp \
	serialization/tokenizer.cpp \
	zipios++/xcoll.cpp \
	server/game.hpp \
	server/input_stream.hpp \
	server/metrics.hpp \
	server/player.hpp \
	config.hpp \
	filesystem.hpp \
	game_config.hpp \
	gettext.hpp \
	log.hpp \
	network.hpp \
	network_worker.hpp \
	thread.hpp \
	tstring.hpp \
	serialization/binary_wml.hpp \
	serialization/string_utils.hpp \
	zipios++/xcoll.hpp

wesnothd_LDADD = @SDL_NET_LIBS@ @SDL_LIBS@ $(LIBZIPIOS) $(LIBINTL)

#############################################################################
#    Campaign Server                                                        #
#############################################################################

campaignd_SOURCES = \
	campaign_server/campaign_server.cpp \
	config.cpp \
	filesystem.cpp \
	game_config.cpp \
	gettext.cpp \
	log.cpp \
	network.cpp \
	network_worker.cpp \
	publish_campaign.cpp \
	thread.cpp \
	tstring.cpp \
	serialization/binary_wml.cpp \
	serialization/parser.cpp \
	serialization/string_utils.cpp \
	serialization/tokenizer.cpp \
	zipios++/xcoll.cpp \
	config.hpp \
	filesystem.hpp \
	game_config.hpp \
	gettext.hpp \
	log.hpp \
	network.hpp \
	network_worker.hpp \
	publish_campaign.hpp \
	serialization/binary_wml.hpp \
	serialization/parser.hpp \
	serialization/preprocessor.hpp \
	serialization/string_utils.hpp \
	serialization/tokenizer.hpp \
	thread.hpp \
	tstring.hpp \
	zipios++/xcoll.hpp

campaignd_LDADD = @SDL_NET_LIBS@ @SDL_LIBS@ $(LIBZIPIOS) $(LIBINTL)

#############################################################################
#    Castle building helpers                                                #
#############################################################################

exploder_SOURCES = \
	tools/exploder.cpp \
	tools/exploder_utils.cpp \
	tools/exploder_cutter.cpp \
	tools/exploder_composer.cpp \
	tools/dummy_video.cpp \
	config.cpp \
	filesystem.cpp \
	game_config.cpp \
	sdl_utils.cpp \
	log.cpp \
	tstring.cpp \
	serialization/parser.cpp \
	serialization/preprocessor.cpp \
	serialization/string_utils.cpp \
	serialization/tokenizer.cpp \
	zipios++/xcoll.cpp \
	tools/exploder_composer.hpp \
	tools/exploder_cutter.hpp \
	tools/exploder_utils.hpp \
	serialization/parser.hpp \
	serialization/preprocessor.hpp \
	serialization/string_utils.hpp \
	serialization/tokenizer.hpp \
	zipios++/xcoll.hpp \
	tstring.hpp \
	gettext.cpp

cutter_SOURCES = \
	tools/cutter.cpp \
	tools/exploder_utils.cpp \
	tools/exploder_cutter.cpp \
	tools/dummy_video.cpp \
	config.cpp \
	filesystem.cpp \
	game_config.cpp \
	sdl_utils.cpp \
	log.cpp \
	tstring.cpp \
	serialization/parser.cpp \
	serialization/preprocessor.cpp \
	serialization/string_utils.cpp \
	serialization/tokenizer.cpp \
	zipios++/xcoll.cpp \
	tools/exploder_composer.hpp \
	tools/exploder_cutter.hpp \
	tools/exploder_utils.hpp \
	serialization/parser.hpp \
	serialization/preprocessor.hpp \
	serialization/string_utils.hpp \
	serialization/tokenizer.hpp \
	zipios++/xcoll.hpp \
	tstring.hpp \
	gettext.cpp

exploder_LDADD = @SDL_IMAGE_LIBS@ @SDL_LIBS@ $(LIBZIPIOS) $(LIBINTL) $(PNG_LIBS)
cutter_LDADD = @SDL_IMAGE_LIBS@ @SDL_LIBS@ $(LIBZIPIOS) $(LIBINTL) $(PNG_LIBS)

AM_CXXFLAGS = -I $(srcdir)/sdl_ttf -I../intl -I$(top_srcdir)/intl @SDL_CFLAGS@ -DWESNOTH_PATH=\"$(pkgdatadir)\" \
	-DLOCALEDIR=\"$(LOCALEDIR)\" -DHAS_RELATIVE_LOCALEDIR=$(HAS_RELATIVE_LOCALEDIR) -DFIFODIR=\"$(fifodir)\"

AM_CFLAGS = -I $(srcdir)/sdl_ttf -I../intl -I$(top_srcdir)/intl @SDL_CFLAGS@ -DWESNOTH_PATH=\"$(pkgdatadir)\" \
	-DLOCALEDIR=\"$(LOCALEDIR)\" -DHAS_RELATIVE_LOCALEDIR=$(HAS_RELATIVE_LOCALEDIR)

if X11
    CXXFLAGS += -D_X11 @X_CFLAGS@
    CFLAGS += -D_X11 @X_CFLAGS@
endif
if GCC
    CXXFLAGS += -fno-omit-frame-pointer
    CFLAGS += -fno-omit-frame-pointer
endif

CXXLD = $(LDPREFIX) $(CXX)


THELIBS = $(SDL_IMAGE_LIBS) $(SDL_MIXER_LIBS) $(SDL_NET_LIBS) \
	$(SDL_TTF_LIBS) $(SDL_LIBS) $(LIBZIPIOS) $(FREETYPE_LIBS) $(LIBINTL)

wesnoth_LDADD = $(THELIBS)
wesnoth_editor_LDADD = $(THELIBS)

if STATIC
LDFLAGS += -all-static
endif

#if STATIC
#LIBS += -static -L/usr/lib -Wl,-rpath,/usr/lib -L/usr/X11R6/lib -lSDL_image \
#-lSDL_mixer -lSDL_net -lSDL_ttf -lSDL -lpthread -ldl -laudio -lXt -lX11 -lXext \
#-lSDL_image -lSDL_mixer -lSDL_net -lSDL_ttf -lstdc++ -lm -lSM -lICE -ljpeg \
#-lpng -lz -lvorbisfile -lvorbis -logg -lsmpeg -lfreetype
#endif

if SERVER
install-exec-hook:
	mkdir -p -m 0700 $(DESTDIR)$(fifodir)
	chown $(serveruid):$(servergid) $(DESTDIR)$(fifodir)

uninstall-hook:
	rm -rf $(DESTDIR)$(fifodir)
else
install-exec-hook:
uninstall-hook:
endif
