# The following flags are defined to have a meaning
#
# * base : the corresponding tile has already graphics for the terrain
# base. No other one should be added.
# * transition-$direction : the corresponding tile already has the transition
# in the given direction (or should not have one). No other one should be
# added.
# * keep-of-$castle : castle being a tile letter. The corresponding tile is the
# keep correspoding to the given castle tile
#
# when adding new probabilities update the commented line
# the proper way to calculate the propabilities is described here
# http://www.wesnoth.org/wiki/Terrain_Graphics_Probability

# The following should be kept on top of the file
{terrain-graphics}

#-----------------------------------------------------------------
# Forest<->Castle|Encampment special cases, also used by some other
# terrain
# Macro's moved to terrain-graphics/forestcastle.cfg
#-----------------------------------------------------------------

{FORESTADJCASTLEA Ff (C*,K*,_K,Xu,Ql,Qxu) 100 forest-castle}
{FORESTADJCASTLEA Fa (C*,K*,_K,Xu,Ql,Qxu) 100 snow-forest-castle}
{FORESTADJCASTLEA Ft (C*,K*,_K,Xu,Ql,Qxu) 100 tropical-forest-castle}
{FORESTADJCASTLEA Uf (C*,K*,_K,Xu,Ql,Qxu) 100 mushrooms-castle}


{FORESTADJCASTLES Ff (C*,K*,_K,Xu,Ql,Qxu) 100 forest-castle}
{FORESTADJCASTLES Fa (C*,K*,_K,Xu,Ql,Qxu) 100 snow-forest-castle}
{FORESTADJCASTLES Ft (C*,K*,_K,Xu,Ql,Qxu) 100 tropical-forest-castle}
{FORESTADJCASTLES Uf (C*,K*,_K,Xu,Ql,Qxu) 100 mushrooms-castle}

{FORESTADJCASTLEO Ff (C*,K*,_K,Xu,Ql,Qxu) 100 forest-castle}
{FORESTADJCASTLEO Fa (C*,K*,_K,Xu,Ql,Qxu) 100 snow-forest-castle}
{FORESTADJCASTLEO Ft (C*,K*,_K,Xu,Ql,Qxu) 100 tropical-forest-castle}
{FORESTADJCASTLEO Uf (C*,K*,_K,Xu,Ql,Qxu) 100 mushrooms-castle}

{FORESTADJCASTLE  Ff (C*,K*,_K,Xu,Ql,Qxu) 100 forest-castle}
{FORESTADJCASTLE  Fa (C*,K*,_K,Xu,Ql,Qxu) 100 snow-forest-castle}
{FORESTADJCASTLE  Ft (C*,K*,_K,Xu,Ql,Qxu) 100 tropical-forest-castle}
{FORESTADJCASTLE  Uf (C*,K*,_K,Xu,Ql,Qxu) 100 mushrooms-castle}

{MOUNTAINADJCASTLEA (Mm,Vhm,Xm) (C*,K*,_K,Xu,Ql,Qxu) 100 mountains-castle}
{FORESTADJCASTLE    (Mm,Vhm,Xm) (C*,K*,_K,Xu,Ql,Qxu) 100 mountains-castle}

#33% 17% 5% 45%
{FORESTADJ Ff (W*,M*,Hd,V*,Xu,Ql,Qxu) 33  forest_small}
{FORESTADJ Ff (W*,M*,Hd,V*,Xu,Ql,Qxu) 25  forest3}
{FORESTADJ Ff (W*,M*,Hd,V*,Xu,Ql,Qxu) 10  forest4}
{FORESTADJ Ff (W*,M*,Hd,V*,Xu,Ql,Qxu) 100 forest2_small}

{FORESTADJ Fa (W*,M*,Hd,V*,Xu,Ql,Qxu) 100 snow-forest_small}

{FORESTADJ Uf (W*,M*,Hd,V*,Xu,Ql,Qxu) 100 mushrooms-castle}


#define SWAMPADJSINGLE FID ID NID PROB TILE
[terrain_graphics]
      map="
, 1
3 , 3
, 2
3 , 3
, 3"

         [tile]
                 pos=1
                 type={ID}
         [/tile]

         [tile]
                 pos=2
                 type={FID}
                 no_flag="overlay"
                 set_flag="overlay"
         [/tile]

         [tile]
                 pos=3
                 type={NID}
         [/tile]

         probability={PROB}
         rotations=n,ne,se,s,sw,nw

         [image]
                 name={TILE}-@R0
                 position=vertical
                 base=90,144
         [/image]


[/terrain_graphics]
#enddef

{SWAMPADJSINGLE (Ss,Vs) (C*,K*,_K,H*,M*,Vhh*,Vhm,Xm) (!,C*,K*,_K,H*,M*,Vhh*,Vhm,Xm) 100 reed-castle}
{SWAMPADJSINGLE Chs  (!,Ch*)  Chs                 100 reed-castle}

{FORESTADJ (Ss,Vs)   (C*,K*,_K,H*,M*,Vhh*,Vhm,Xm) 8   reed1-small}
{FORESTADJ (Ss,Vs)   (C*,K*,_K,H*,M*,Vhh*,Vhm,Xm) 13  reed2-small}
{FORESTADJ (Ss,Vs)   (C*,K*,_K,H*,M*,Vhh*,Vhm,Xm) 21  reed3-small}
{FORESTADJ (Ss,Vs)   (C*,K*,_K,H*,M*,Vhh*,Vhm,Xm) 100 reed4-small}
{FORESTADJ Chs       (!,Ch*)                      8   reed1-small}
{FORESTADJ Chs       (!,Ch*)                      13  reed2-small}
{FORESTADJ Chs       (!,Ch*)                      21  reed3-small}
{FORESTADJ Chs       (!,Ch*)                      100 reed4-small}



# Mountains
# macros found in terrain-graphics/mountains.cfg

#TWOBYFOUR TYPE NAME1 NAME2 NAME3 NAME4 NAME5 FLAG PROB
{TWOBYFOUR   (Mm,Vhm,Xm) mountain_range3_1 mountain_range3_2 mountain_range3_3 mountain_range3_4 mountain_range3_5 overlay 18}

#TWOBYFOUR2 TYPE NAME1 NAME2 NAME3 NAME4 NAME5 FLAG PROB
{TWOBYFOUR2  (Mm,Vhm,Xm) mountain_range4_1 mountain_range4_2 mountain_range4_3 mountain_range4_4 mountain_range4_5 overlay 26}

#ONEBYTHREE TYPE NAME1 NAME2 NAME3 FLAG PROB
{ONEBYTHREE  (Mm,Vhm,Xm) mountain_range1_1 mountain_range1_2 mountain_range1_3 overlay 20}

#ONEBYTHREE2 TYPE NAME1 NAME2 NAME3 FLAG PROB
{ONEBYTHREE2 (Mm,Vhm,Xm) mountain_range2_1 mountain_range2_2 mountain_range2_3 overlay 20}

# TWOBYTWO TYPE NAME1 NAME2 NAME3 FLAG PROB
{TWOBYTWO    (Mm,Vhm,Xm) mountain5_1 mountain5_2 mountain5_3 overlay 40}
{TWOBYTWO    (Mm,Vhm,Xm) mountain6_1 mountain6_2 mountain6_3 overlay 30}

#Macro for Single Hex
#define SHEX TYPE FLAG PROB TILE
[terrain_graphics]
      map="
, *
* , *
, 1
* , *
, *"

         [tile]
                 pos=1
                 type={TYPE}
                 no_flag={FLAG}
                 set_flag={FLAG}
         [/tile]

         probability={PROB}

         [image]
                 name={TILE}
                 position=vertical
                 base=90,146
         [/image]
[/terrain_graphics]
#enddef

#Single hex mountain tiles (mountain + village)
#33% 33% 33%
{SHEX (Mm,Vhm,Xm) overlay 33  mountains3}
{SHEX (Mm,Vhm,Xm) overlay 50  mountains2}
{SHEX (Mm,Vhm,Xm) overlay 100 mountains}

#Single hex normal forest tiles
#33% 17% 5% 45%
{SHEX Ff          overlay 33  forest}
{SHEX Ff          overlay 25  forest3}
{SHEX Ff          overlay 10  forest4}
{SHEX Ff          overlay 100 forest2}

#Single hex tropical forest tiles
#33% 17% 5% 45%
{SHEX Ft          overlay 33  tropical-forest2}
{SHEX Ft          overlay 25  tropical-forest3}
{SHEX Ft          overlay 10  tropical-forest4}
{SHEX Ft          overlay 100 tropical-forest}

#Single hex normal snow forest tiles
#25% 25% 25% 25%
{SHEX Fa          overlay 25  snow-forest2}
{SHEX Fa          overlay 33  snow-forest3}
{SHEX Fa          overlay 50  snow-forest4}
{SHEX Fa          overlay 100 snow-forest}

#Single hex Great-tree
#33% 17% 50%
{SHEX Fet         overlay 33  great-tree3}
{SHEX Fet         overlay 25  great-tree2}
{SHEX Fet         overlay 100 great-tree1}

#Single hex underground mushroom forest tiles
#20% 20% 20% 20% 20%
{SHEX Uf          overlay 20  mushrooms2}
{SHEX Uf          overlay 25  mushrooms3}
{SHEX Uf          overlay 33  mushrooms4}
{SHEX Uf          overlay 50  mushrooms5}
{SHEX Uf          overlay 100 mushrooms}

#Single hex Cave lit by Beam of Light
#33% 33% 33%
{SHEX Uui         overlay 33  cave-beam3}
{SHEX Uui         overlay 50  cave-beam2}
{SHEX Uui         overlay 100 cave-beam1}

{SHEX (Ss,Vs,Chs) overlay 10  reed3}
{SHEX (Ss,Vs,Chs) overlay 20  reed1}
{SHEX (Ss,Vs,Chs) overlay 25  reed2}
{SHEX (Ss,Vs,Chs) overlay 33  reed4}
{SHEX (Ss,Vs,Chs) overlay 50  reed5}
{SHEX (Ss,Vs,Chs) overlay 100 reed6}

#Macro for clouds
#define CLOUDS TYPE NAME1 NAME2 NAME3 FLAG PROB
[terrain_graphics]
      map="
, *
* , *
, 2
* , *
, *"

         [tile]
                 pos=2
                 type={TYPE}
                 no_flag={FLAG}
                 set_flag={FLAG}
         [/tile]

         [image]
                 name={NAME1}
                 position=vertical
                 base=32,208
         [/image]

         [image]
                 name={NAME2}
                 position=vertical
                 base=88,372
         [/image]

         [image]
                 name={NAME3}
                 position=vertical
                 base=142,308
         [/image]

         probability={PROB}
[/terrain_graphics]
#enddef

#33% 33% 33%
{CLOUDS Xm cloud1_1 cloud1_2 cloud1_3 clouds 33}
{CLOUDS Xm cloud1_1 cloud2_2 cloud1_3 clouds 50}
{CLOUDS Xm cloud1_1 cloud3_2 cloud1_3 clouds 100}

{PEAKS_ONEBYTWO Xm mountain_peak_range1_1 mountain_peak_range1_2 peaks 15}

{PEAKS_LARGE Xm mountain_peak_large1  peaks 25}
{PEAKS_LARGE Xm mountain_peak_large2  peaks 33}

{PEAKS Xm mountain_peak1  peaks 16}
{PEAKS Xm mountain_peak2  peaks 20}
{PEAKS Xm mountain_peak3  peaks 27}
{PEAKS Xm mountain_peak4  peaks 40}
{PEAKS Xm mountain_peak5  peaks 80}

#
#       >  V I L L A G E   B U I L D I N G S   <

# Flagged as 'village' so they can be placed on
# top of both 'base' and 'overlay'

#Single hex human villages (grassland, hills, mountains)
#30% 30% 40%
{SHEX Vhg       village 30  village-human}
{SHEX Vhg       village 43  village-human2}
{SHEX Vhg       village 100 village-human3}

{SHEX (Vhm,Vhh) village 100 village-human4}

#Single hex human villages (snow)
#33% 33% 33%
{SHEX Vha       village 33  village-human-snow}
{SHEX Vha       village 50  village-human-snow2}
{SHEX Vha       village 100 village-human-snow3}

{SHEX Vhha      village 100 village-human-snow4}

#Single hex tropical village
{SHEX Vht       village 100 village-tropical-forest}

#Single hex elven villages
#10% 25% 25% 40%
{SHEX Veg       village 10  village-elven}
{SHEX Veg       village 28  village-elven3}
{SHEX Veg       village 38  village-elven4}
{SHEX Veg       village 100 village-elven2}

#Single hex elven villages (snow)
#10% 25% 25% 40%
{SHEX Vea       village 10  village-elven-snow}
{SHEX Vea       village 28  village-elven-snow3}
{SHEX Vea       village 38  village-elven-snow4}
{SHEX Vea       village 100 village-elven-snow2}

#Single hex desert villages
{SHEX Vda       village 100 village-desert}
{SHEX Vdt       village 100 village-desert2}

#Single hex underground villages
#33% 33% 33%
{SHEX Vu        village 33  village-cave}
{SHEX Vu        village 50  village-cave2}
{SHEX Vu        village 100 village-cave3}

{SHEX Vud       village 100 village-dwarven}

#Single hex swamp village
#50% 50%
{SHEX Vs        village 50  village-swampwater}
{SHEX Vs        village 100 village-swampwater2}

#Single hex coastal village
{SHEX Vwm       village 100 village-coast}




#
#       >  V I L L A G E   B A S E   T E R R A I N  <
#

{TERRAIN_BASE (Vhg,Veg) grassland-r1}
{TERRAIN_BASE (Vha,Vea) snow}
{TERRAIN_BASE Vd*       desert}
{TERRAIN_BASE Vu*       cave-floor1}
{TERRAIN_BASE Vhh       hills-variation1}
{TERRAIN_BASE Vhha      snow-hills}
{TERRAIN_BASE Vht       savanna}
{TERRAIN_BASE Vwm       coast}
{TERRAIN_BASE Vs        swampwater}
#{TERRAIN_BASE b mountains}


#
#       >  B A S E   T E R R A I N S  <
#

#10% 3% 13% 7% 67%
{TERRAIN_BASE_PROB  (Uu*,Uf)          cave-floor4		       10}
{TERRAIN_BASE_PROB  (Uu*,Uf)          cave-floor3		       3}
{TERRAIN_BASE_PROB  (Uu*,Uf)          cave-floor2		       15}
{TERRAIN_BASE_PROB  (Uu*,Uf)          cave-floor		       10}
{TERRAIN_BASE       (Uu*,Uf)          cave-floor1}

{TERRAIN_BASE       Xu                cavewall}

#33% 33% 33%
{TERRAIN_BASE_PROB  Uh                cave-hills-variation1    33}
{TERRAIN_BASE_PROB  Uh                cave-hills-variation2    50}
{TERRAIN_BASE       Uh                cave-hills-variation3}

#33% 33% 33%
{TERRAIN_BASE_PROB  Hh                hills-variation1         33}
{TERRAIN_BASE_PROB  Hh                hills-variation2         50}
{TERRAIN_BASE       Hh                hills-variation3}

#30% 30% 40%
{TERRAIN_BASE_PROB  Ha                snow-hills3              30}
{TERRAIN_BASE_PROB  Ha                snow-hills2              43}
{TERRAIN_BASE       Ha                snow-hills}

#30% 30% 40%
{TERRAIN_BASE_PROB  (Aa,Fa)           snow2                    30}
{TERRAIN_BASE_PROB  (Aa,Fa)           snow3 	               43}
{TERRAIN_BASE       (Aa,Fa)           snow}


{TERRAIN_BASE       Qxu               chasm}

{TERRAIN_BASE_PROB  Ql                lava                     33}
{TERRAIN_BASE_PROB  Ql                lava2                    50}
{TERRAIN_BASE       Ql                lava3}


#g 2% 2% 3% 3% 9% 9% 9% 9% 9% 9% 9% 27%
{TERRAIN_BASE_PROB  Gg                grassland-rocks1         2}
{TERRAIN_BASE_PROB  Gg                grassland-rocks2         2}
{TERRAIN_BASE_PROB  Gg                grassland-flowers1       3}
{TERRAIN_BASE_PROB  Gg                grassland-flowers2       3}
#f? 10% 10% 10% 10% 10% 10% 10% 30%
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r1             10}
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r2             11}
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r3             13}
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r4             14}
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r5             17}
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r6             20}
{TERRAIN_BASE_PROB  (Gg,Ff,Fet)       grassland-r7             25}
{TERRAIN_BASE       (Gg,Ff,Fet)       grassland-r8}

{TERRAIN_BASE_PROB  (Gs,Ft)           savanna                  33}
{TERRAIN_BASE_PROB  (Gs,Ft)           savanna2                 50}
{TERRAIN_BASE       (Gs,Ft)           savanna3}

{TERRAIN_BASE       Re                dirt}

#33% 33% 33%
{TERRAIN_BASE_PROB  Rr                road3                    33}
{TERRAIN_BASE_PROB  Rr                road2                    50}
{TERRAIN_BASE       Rr                road}

{TERRAIN_BASE       Rd                desert-road}

{TERRAIN_BASE       Dc                desert_crater}

#2% 2% 2% 24% 24% 3% 3% 3% 3% 36%
{TERRAIN_BASE_PROB  Dd                desert-plant             2}
{TERRAIN_BASE_PROB  Dd                desert-plant2            2}
{TERRAIN_BASE_PROB  Dd                desert-plant3            2}
{TERRAIN_BASE_PROB  Dd                desert2                  25}
{TERRAIN_BASE_PROB  Dd                desert3                  34}
{TERRAIN_BASE_PROB  Dd                desert4                  6}
{TERRAIN_BASE_PROB  Dd                desert5                  6}
{TERRAIN_BASE_PROB  Dd                desert6                  7}
{TERRAIN_BASE_PROB  Dd                desert7                  7}
{TERRAIN_BASE       Dd                desert}

{TERRAIN_BASE       Dr                sand_rubble}

#33% 33% 33%
{TERRAIN_BASE_PROB  Hd                desert-hills2            33}
{TERRAIN_BASE_PROB  Hd                desert-hills3            50}
{TERRAIN_BASE       Hd                desert-hills}

#25% 25% 25% 25%
{TERRAIN_BASE_PROB  Md                desert-mountain-peak1    25}
{TERRAIN_BASE_PROB  Md                desert-mountain-peak2    33}
{TERRAIN_BASE_PROB  Md                desert-mountain-peak3    50}
{TERRAIN_BASE       Md                desert-mountains}

#10% 10% 10% 70%
{TERRAIN_BASE_PROB  Ds                sand-rock1               10}
{TERRAIN_BASE_PROB  Ds                sand-rock2               11}
{TERRAIN_BASE_PROB  Ds                sand-rock3               13}
{TERRAIN_BASE       Ds                sand}

{TERRAIN_BASE       Do                desert-oasis}


#8% 8% 8% 8% 23% 23% 23%
{TERRAIN_BASE_PROB  Ss                swampwater-flowers1      8}
{TERRAIN_BASE_PROB  Ss                swampwater-flowers2      9}
{TERRAIN_BASE_PROB  (Ss,Bss*)         swampwater-plant1        10}
{TERRAIN_BASE_PROB  (Ss,Bss*)         swampwater-plant2        11}
{TERRAIN_BASE_PROB  (Ss,Bss*)         swampwater2              33}
{TERRAIN_BASE_PROB  (Ss,Bss*)         swampwater3              50}
{TERRAIN_BASE       (Ss,Bss*)         swampwater}

#10% 10% 10% 10% 25% 35%
{TERRAIN_BASE_PROB  Ai                ice2                     10}
{TERRAIN_BASE_PROB  Ai                ice3                     11}
{TERRAIN_BASE_PROB  Ai                ice5                     13}
{TERRAIN_BASE_PROB  Ai                ice6                     14}
{TERRAIN_BASE_PROB  Ai                ice4                     42}
{TERRAIN_BASE       Ai                ice}

#set them to 33 for some irregulrity
#33% 67%
{TERRAIN_BASE_PROB  Wwf               ford2                    33}
{TERRAIN_BASE       Wwf               ford}

#30% 30% 40%
{TERRAIN_BASE_PROB  (Wo,Bwo*)         ocean3                   30}
{TERRAIN_BASE_PROB  (Wo,Bwo*)         ocean2                   43}
{TERRAIN_BASE       (Wo,Bwo*)         ocean}

#30% 30% 40%
{TERRAIN_BASE_PROB  (Ww,Bww*)         coast3                   30}
{TERRAIN_BASE_PROB  (Ww,Bww*)         coast2                   43}
{TERRAIN_BASE       (Ww,Bww*)         coast}


#{TERRAIN_BASE       ~                 fog}


#This one is to fill the "gaps" at the map edges. There are no
#non-multihex mountains so hills fit better
{TERRAIN_BASE       (Mm,Vhm,Xm)       hills-variation1}

#{CANYON X canyon}
#added ruins
{BRIDGE Bww\ Bww| Bww/  (W*,Ss) (C*,K*,_K,F*)   bridge}
{BRIDGE Bwo\ Bwo| Bwo/  (W*,Ss) (C*,K*,_K,F*)   bridge}
{BRIDGE Bss\ Bss| Bss/  (W*,Ss) (C*,K*,_K,F*)   bridge}


#
#     >  T R A N S I T I O N S   B E T W E E N   T E R R A I N S  <
#

# Special transitions go first

#
# The keep mechanism is deprecated! Is only there for backward compatibility.
#

# Castle and keeps. Always use the same letter for keeps: the CASTLE_AND_KEEP
# macro will determine the correct graphics to use, according to the adjacent
# castle letter.

# Flags the keep, they must be flagged to be recognized by the
# {CASTLE_AND_foo_KEEP} macros

{FLAG_IF_ADJACENT _K Ch  keep-of-ch  keep-flag}
{FLAG_IF_ADJACENT _K Chr keep-of-chr keep-flag}
{FLAG_IF_ADJACENT _K Chw keep-of-chw keep-flag}
{FLAG_IF_ADJACENT _K Chs keep-of-chs keep-flag}

{FLAG_IF_ADJACENT _K Ce  keep-of-ce  keep-flag}
{FLAG_IF_ADJACENT _K Cud keep-of-cud keep-flag}
{FLAG_REMAINING   _K     keep-of-ch  keep-flag}

#
#     >  C A S T L E S   B A S E   T E R R A I N S  <
#

{DISABLE_TRANSITIONS _K}
{DISABLE_TRANSITIONS Kh*}
{DISABLE_TRANSITIONS Ch}

{TERRAIN_BASE        (Ch,Kh*)  castle}

{TERRAIN_BASE_PROB   Cud       dwarven-castle-floor3	33}
{TERRAIN_BASE_PROB   Cud       dwarven-castle-floor2	50}
{TERRAIN_BASE        Cud       dwarven-castle-floor}

{TERRAIN_BASE        Kud       dwarven-keep-floor}


{TERRAIN_BASE        (Ce,Ke)   dirt}

{TERRAIN_BASE        Chr       castle}
{TERRAIN_BASE        Chw       sunken-ruin}
#30% 30% 40%
{TERRAIN_BASE_PROB   Chs       swampwater2            30}
{TERRAIN_BASE_PROB   Chs       swampwater3            43}
{TERRAIN_BASE        Chs       swampwater}

#{TERRAIN_BASE O orccastle}

{TERRAIN_BASE_FLAG _K keep-of-ch castle}
{TERRAIN_BASE_FLAG _K keep-of-cud dwarven-keep-floor}
{TERRAIN_BASE_FLAG _K keep-of-ce dirt}

{TERRAIN_BASE_FLAG _K keep-of-chr castle}
{TERRAIN_BASE_FLAG _K keep-of-chw castle}
{TERRAIN_BASE_FLAG _K keep-of-chs castle}

#define TERRAIN_ADJACENT_CORNER_BOTH INNER OUTER IMAGE
{TERRAIN_ADJACENT_CORNER  {INNER} {OUTER} {OUTER} 52,76 {IMAGE}-convex}
{TERRAIN_ADJACENT_CORNER  {OUTER} {INNER} {INNER} 56,68 {IMAGE}-concave}
#enddef

#define TERRAIN_ADJACENT_CORNER_BOTH_PROB INNER OUTER  IMAGE PROB
{TERRAIN_ADJACENT_CORNER  {INNER} {OUTER} {OUTER} 52,76 {IMAGE}-convex  {PROB}}
{TERRAIN_ADJACENT_CORNER  {OUTER} {INNER} {INNER} 56,68 {IMAGE}-concave {PROB}}
#enddef

#Legacy function for old stlye keeps

#define KEEP_ADJACENT_CORNER_BOTH CASTLE OUTER FLAG IMAGE
{TERRAIN_ADJACENT_CORNER_FLAG1  _K      {OUTER}  {OUTER}  52,76 {FLAG} {IMAGE}-convex}
{TERRAIN_ADJACENT_CORNER        {OUTER}  _K      {CASTLE} 56,68 {IMAGE}-concave}
{TERRAIN_ADJACENT_CORNER        {OUTER} {CASTLE} _K       56,68 {IMAGE}-concave}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K      _K       {OUTER}  56,68 {FLAG} {IMAGE}-concave}
#enddef



# Loyalist castle
{TERRAIN_ADJACENT_CORNER       Ch               (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 castle-convex}
{TERRAIN_ADJACENT_CORNER       (!,Ch*,Kh*,_K)   Ch                Ch*              56,68 castle-concave}
{TERRAIN_ADJACENT_CORNER       (Kh,_K)          Ch*               Ch*              54,72 keep-inside}
{TERRAIN_ADJACENT_CORNER_FLAG1 _K               (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 keep-of-ch keep-wall}
{TERRAIN_ADJACENT_CORNER       Kh               (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 keep-wall}
{TERRAIN_ADJACENT_CORNER       (Kh,_K)          (!,Ch*,Kh*,_K)    Ch*              52,72 keep-wall-0}
{TERRAIN_ADJACENT_CORNER       (Kh,_K)          Ch*               (!,Ch*,Kh*,_K)   56,76 keep-wall-1}
{TERRAIN_ADJACENT_CORNER_FLAG1 _K               _K                (!,_K)           56,76 keep-of-ch keep-keep}
{TERRAIN_ADJACENT_CORNER       Kh               Kh*               (!,Kh*)          56,76 keep-keep}

# ruined castle

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  Chr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin5-convex  17}
{TERRAIN_ADJACENT_CORNER_PROB  Chr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin4-convex  20}
{TERRAIN_ADJACENT_CORNER_PROB  Chr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin3-convex  25}
{TERRAIN_ADJACENT_CORNER_PROB  Chr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin2-convex  33}
{TERRAIN_ADJACENT_CORNER_PROB  Chr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin1-convex  50}
{TERRAIN_ADJACENT_CORNER_PROB  Chr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 castle-convex 100}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chr               Ch*              56,68 ruin5-concave  17}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chr               Ch*              56,68 ruin4-concave  20}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chr               Ch*              56,68 ruin3-concave  25}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chr               Ch*              56,68 ruin2-concave  33}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chr               Ch*              56,68 ruin1-concave  50}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chr               Ch*              56,68 castle-concave 100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khr,_K)         Ch*               Ch*              54,72 ruinkeep1-inside 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khr,_K)         Ch*               Ch*              54,72 keep-inside 100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   54,72 keep-of-chr ruinkeep1-wall 75}
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 keep-of-chr keep-wall      100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  Khr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   54,72 ruinkeep1-wall   75}
{TERRAIN_ADJACENT_CORNER_PROB  Khr              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 keep-wall        100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khr,_K)         (!,Ch*,Kh*,_K)    Ch*              54,72 ruinkeep1-wall-0 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khr,_K)         (!,Ch*,Kh*,_K)    Ch*              52,72 keep-wall-0      100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khr,_K)         Ch*               (!,Ch*,Kh*,_K)   54,72 ruinkeep1-wall-1 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khr,_K)         Ch*               (!,Ch*,Kh*,_K)   56,76 keep-wall-1      100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         _K                (!,_K)           54,72 keep-of-chr ruinkeep1-keep 75}
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         _K                (!,_K)           56,76 keep-of-chr keep-keep      100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  Khr              Kh*               (!,Kh*)          54,72 ruinkeep1-keep   75}
{TERRAIN_ADJACENT_CORNER_PROB  Khr              Kh*               (!,Kh*)          56,76 keep-keep        100}



# sunken ruined castle
#{DISABLE_TRANSITIONS Q}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (W*,Ss)           (W*,Ss)          52,76 sunken-ruin5-convex 17}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (W*,Ss)           (W*,Ss)          52,76 sunken-ruin4-convex 20}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (W*,Ss)           (W*,Ss)          52,76 sunken-ruin3-convex 25}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (W*,Ss)           (W*,Ss)          52,76 sunken-ruin2-convex 33}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (W*,Ss)           (W*,Ss)          52,76 sunken-ruin1-convex 50}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (W*,Ss)           (W*,Ss)          52,76 sunken-ruin-convex  100}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss)          Chw               Ch*              56,68 sunken-ruin5-concave 17}
{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss)          Chw               Ch*              56,68 sunken-ruin4-concave 20}
{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss)          Chw               Ch*              56,68 sunken-ruin3-concave 25}
{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss)          Chw               Ch*              56,68 sunken-ruin2-concave 33}
{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss)          Chw               Ch*              56,68 sunken-ruin1-concave 50}
{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss)          Chw               Ch*              56,68 sunken-ruin-concave  100}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin5-convex  17}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin4-convex  20}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin3-convex  25}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin2-convex  33}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 ruin1-convex  50}
{TERRAIN_ADJACENT_CORNER_PROB  Chw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 castle-convex 100}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chw               Ch*              56,68 ruin5-concave  17}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chw               Ch*              56,68 ruin4-concave  20}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chw               Ch*              56,68 ruin3-concave  25}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chw               Ch*              56,68 ruin2-concave  33}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chw               Ch*              56,68 ruin1-concave  50}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chw               Ch*              56,68 castle-concave 100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khw,_K)         Ch*               Ch*              54,72 sunken-ruinkeep1-inside 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khw,_K)         Ch*               Ch*              54,72 sunkenkeep-inside       100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 keep-of-chw sunken-ruinkeep1-wall 75}
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 keep-of-chw sunkenkeep-wall 100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  Khw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 sunken-ruinkeep1-wall 75}
{TERRAIN_ADJACENT_CORNER_PROB  Khw              (!,Ch*,Kh*,_K)    (!,Ch*,Kh*,_K)   52,76 sunkenkeep-wall       100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khw,_K)         (!,Ch*,Kh*,_K)    Ch*              52,72 sunken-ruinkeep1-wall-0 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khw,_K)         (!,Ch*,Kh*,_K)    Ch*              52,72 sunkenkeep-wall-0       100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khw,_K)         Ch*               (!,Ch*,Kh*,_K)   56,76 sunken-ruinkeep1-wall-1 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khw,_K)         Ch*               (!,Ch*,Kh*,_K)   56,76 sunkenkeep-wall-1       100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         K                 (!,_K)           56,76 keep-of-chw sunken-ruinkeep1-keep 75}
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         K                 (!,_K)           56,76 keep-of-chw sunkenkeep-keep 100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  Khw              Kh*               (!,Kh*)          56,76 sunken-ruinkeep1-keep 75}
{TERRAIN_ADJACENT_CORNER_PROB  Khw              Kh*               (!,Kh*)          56,76 sunkenkeep-keep       100}


# swamp ruined castle
#{DISABLE_TRANSITIONS q}

#17% 17% 17% 17% 17% 17%
#{TERRAIN_ADJACENT_CORNER_PROB  Chs             (W*,Ss,Vwm,Vs)  (W*,Ss,Vwm,Vs)  52,76 ruin5-convex 17}
#{TERRAIN_ADJACENT_CORNER_PROB  Chs             (W*,Ss,Vwm,Vs)  (W*,Ss,Vwm,Vs)  52,76 ruin4-convex 20}
#{TERRAIN_ADJACENT_CORNER_PROB  Chs             (W*,Ss,Vwm,Vs)  (W*,Ss,Vwm,Vs)  52,76 ruin3-convex 25}
#{TERRAIN_ADJACENT_CORNER_PROB  Chs             (W*,Ss,Vwm,Vs)  (W*,Ss,Vwm,Vs)  52,76 ruin2-convex 33}
#{TERRAIN_ADJACENT_CORNER_PROB  Chs             (W*,Ss,Vwm,Vs)  (W*,Ss,Vwm,Vs)  52,76 ruin1-convex 50}
#{TERRAIN_ADJACENT_CORNER_PROB  Chs             (W*,Ss,Vwm,Vs)  (W*,Ss,Vwm,Vs)  52,76 ruin-convex  100}

#17% 17% 17% 17% 17% 17%
#{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss,Vwm,Vs)   Chs             Ch*             56,68 ruin5-concave 17}
#{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss,Vwm,Vs)   Chs             Ch*             56,68 ruin4-concave 20}
#{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss,Vwm,Vs)   Chs             Ch*             56,68 ruin3-concave 25}
#{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss,Vwm,Vs)   Chs             Ch*             56,68 ruin2-concave 33}
#{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss,Vwm,Vs)   Chs             Ch*             56,68 ruin1-concave 50}
#{TERRAIN_ADJACENT_CORNER_PROB  (W*,Ss,Vwm,Vs)   Chs             Ch*             56,68 ruin-concave  100}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  Chs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 ruin5-convex 17}
{TERRAIN_ADJACENT_CORNER_PROB  Chs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 ruin4-convex 20}
{TERRAIN_ADJACENT_CORNER_PROB  Chs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 ruin3-convex 25}
{TERRAIN_ADJACENT_CORNER_PROB  Chs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 ruin2-convex 33}
{TERRAIN_ADJACENT_CORNER_PROB  Chs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 ruin1-convex 50}
{TERRAIN_ADJACENT_CORNER_PROB  Chs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 castle-convex  100}

#17% 17% 17% 17% 17% 17%
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chs             Ch*             56,68 ruin5-concave  17}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chs             Ch*             56,68 ruin4-concave  20}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chs             Ch*             56,68 ruin3-concave  25}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chs             Ch*             56,68 ruin2-concave  33}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chs             Ch*             56,68 ruin1-concave  50}
{TERRAIN_ADJACENT_CORNER_PROB  (!,Ch*,Kh*,_K)   Chs             Ch*             56,68 castle-concave 100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khs,_K)         Ch*             Ch*             54,72 ruinkeep1-inside 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khs,_K)         Ch*             Ch*             54,72 keep-inside      100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 keep-of-chs ruinkeep1-wall 75}
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 keep-of-chs keep-wall     100}

{TERRAIN_ADJACENT_CORNER_PROB  Khs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 ruinkeep1-wall   75}
{TERRAIN_ADJACENT_CORNER_PROB  Khs              (!,Ch*,Kh*,_K)  (!,Ch*,Kh*,_K)  52,76 keep-wall       100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khs,_K)         (!,Ch*,Kh*,_K)  Ch*             52,72 ruinkeep1-wall-0 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khs,_K)         (!,Ch*,Kh*,_K)  Ch*             52,72 keep-wall-0     100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_PROB  (Khs,_K)         Ch*             (!,Ch*,Kh*,_K)  56,76 ruinkeep1-wall-1 75}
{TERRAIN_ADJACENT_CORNER_PROB  (Khs,_K)         Ch*             (!,Ch*,Kh*,_K)  56,76 keep-wall-1     100}

#75% 25%
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         _K              (!,_K)          56,76 keep-of-chs ruinkeep1-keep 75}
{TERRAIN_ADJACENT_CORNER_FLAG1_PROB  _K         _K              (!,_K)          56,76 keep-of-chs keep-keep     100}

{TERRAIN_ADJACENT_CORNER_PROB  Khs              Kh*             (!,Kh*)         56,76 ruinkeep1-keep   75}
{TERRAIN_ADJACENT_CORNER_PROB  Khs              Kh*             (!,Kh*)         56,76 keep-keep       100}

# Encampments
{DISABLE_TRANSITIONS (Ce,Ke)}
{TERRAIN_ADJACENT_CORNER_BOTH  (Ce,Ke)          (!,Ce,Ke,Ch*,Kh*,_K)                  encampment}
{KEEP_ADJACENT_CORNER_BOTH     Ce               (!,Ce,Ke,Ch*,Kh*,_K)   keep-of-ce     encampment}

# Cave and dwarven castles
{DISABLE_TRANSITIONS Qxu}
{DISABLE_TRANSITIONS Xu}
{DISABLE_TRANSITIONS (Cud,Kud)}

{TERRAIN_ADJACENT_CORNER_BOTH  Xu               (!,Xu,Cud,Kud,_K)                      cavewall}

{TERRAIN_ADJACENT_CORNER_BOTH  (Cud,Kud)        (!,Xu,Qxu,Ql,Cud,Kud,_K)               dwarven-castle}
{KEEP_ADJACENT_CORNER_BOTH     Cud              (!,Xu,Qxu,Ql,Cud,_K)   keep-of-cud     dwarven-castle}

{TERRAIN_ADJACENT_CORNER_BOTH  (Cud,Kud,_K)     Xu                                     dwarven-castle-wall}

{TERRAIN_ADJACENT_CORNER     (Cud,Kud,_K)       Xu                 (!,Cud,Kud,_K,Xu)   54,68 dwarven-castle-wall-cw}
{TERRAIN_ADJACENT_CORNER     (Cud,Kud,_K)       (!,Cud,Kud,_K,Xu)  Xu                  54,68 dwarven-castle-wall-ccw}

#castle-chasm transitions
{TERRAIN_ADJACENT_CORNER_BOTH  (Cud,Kud)        Qxu                                    chasm-dcastle}
{KEEP_ADJACENT_CORNER_BOTH     Cud              Qxu                     keep-of-cud    chasm-dcastle}

{TERRAIN_ADJACENT_CORNER     (Cud,Kud)          (!,Cud,Kud,_K,Xu,Ql,Qxu)     Qxu       52,76 chasm-dcastle-ccw}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K              (!,Cud,_K,Xu,Ql,Qxu)         Qxu       52,76 keep-of-cud chasm-dcastle-ccw}
{TERRAIN_ADJACENT_CORNER     (Cud,Kud)          Qxu          (!,Cud,Kud,_K,Xu,Ql,Qxu)  52,76 chasm-dcastle-cw}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K              Qxu          (!,Cud,_K,Xu,Ql,Qxu)      52,76 keep-of-cud chasm-dcastle-cw}

#castle-lava transitions

{TERRAIN_ADJACENT_CORNER_BOTH  (Cud,Kud)        Ql                                     lava-dcastle}
{KEEP_ADJACENT_CORNER_BOTH     Cud              Ql                      keep-of-cud    lava-dcastle}

{TERRAIN_ADJACENT_CORNER     (Cud,Kud)           (!,Cud,Kud,_K,Xu,Ql,Qxu)     Ql       52,76 lava-dcastle-ccw}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K               (!,Cud,Kud,_K,Xu,Ql,Qxu)     Ql       52,76 keep-of-cud lava-dcastle-ccw}
{TERRAIN_ADJACENT_CORNER     (Cud,Kud)           Ql          (!,Cud,Kud,_K,Xu,Ql,Qxu)  52,76 lava-dcastle-cw}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K               Ql          (!,Cud,Kud,_K,Xu,Ql,Qxu)  52,76 keep-of-cud lava-dcastle-cw}


#castle-lava-chasm transitions

{TERRAIN_ADJACENT_CORNER        (Cud,Kud)        Qxu            Ql                     52,76 lava-dcastle-chasm-ccw}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K               Qxu            Ql                     52,76 keep-of-cud lava-dcastle-chasm-ccw}
{TERRAIN_ADJACENT_CORNER        (Cud,Kud)        Ql             Qxu                    52,76 lava-dcastle-chasm-cw}
{TERRAIN_ADJACENT_CORNER_FLAG1  _K               Ql             Qxu                    52,76 keep-of-cud lava-dcastle-chasm-cw}


# Orcish castle
#{DISABLE_TRANSITIONS O}
#{TERRAIN_ADJACENT_CORNER       O      !O     !O      54,72 orccastle-convex}
#{TERRAIN_ADJACENT_CORNER       !O     O      O       54,72 orccastle-concave}
#{TERRAIN_ADJACENT_CORNER   -50        K      O      O       <name>}
#{TERRAIN_ADJACENT_CORNER_FLAG1 -50    K      !OK    !OK     keep-of-O <name>}
#{TERRAIN_ADJACENT_CORNER   -50        K      O      !OK     <name>}
#{TERRAIN_ADJACENT_CORNER   -50        K      !OK    O       <name>}

# Lava
{DISABLE_TRANSITIONS Ql}

{TERRAIN_ADJACENT_CORNER_LAYER  Ql               (!,Ql,Qxu)     (!,Ql,Qxu)       -1 52,76 lava-convex}
{TERRAIN_ADJACENT_CORNER_LAYER  (!,Ql,Qxu)       Ql             Ql               -1 52,76 lava-concave}

# Lava-chasm

{TERRAIN_ADJACENT_CORNER_LAYER  Qxu              Ql             Ql               -2 52,76 lava-chasm-convex}
{TERRAIN_ADJACENT_CORNER_LAYER  Ql               Qxu            Qxu              -2 52,76 lava-chasm-concave}

{TERRAIN_ADJACENT_CORNER_LAYER  Ql               Qxu            (!,Ql,Qxu)       -1 52,76 lava-chasm-ccw}
{TERRAIN_ADJACENT_CORNER_LAYER  Ql               (!,Ql,Qxu)     Qxu              -1 52,76 lava-chasm-cw}

# Chasm
{TERRAIN_ADJACENT_CORNER_LAYER  Qxu              (!,Ql,Qxu)     (!,Ql,Qxu)       -1 52,76 chasm-convex}
{TERRAIN_ADJACENT_CORNER_LAYER  Qxu              (!,Ql,Qxu)     Ql               -1 52,76 chasm-convex}
{TERRAIN_ADJACENT_CORNER_LAYER  Qxu              Ql             (!,Ql,Qxu)       -1 52,76 chasm-convex}
{TERRAIN_ADJACENT_CORNER_LAYER  (!,Ql,Qxu)       Qxu            Qxu              -1 52,76 chasm-concave}


# Castle decorations and castle floors. Those must always be after the castles
# are defined.

{BUILDING_FLAG_PROB _K ({VIMG 20,26 tent})          keep-of-ce 50}
{BUILDING_FLAG_PROB _K ({VIMG 20,26 tent2})         keep-of-ce 100}
{BUILDING_FLAG      _K ({VIMG 36,40 dwarven-keep})  keep-of-cud}

{BUILDING_PROBABILITY Ke  ({VIMG 20,26 tent})   50}
{BUILDING_PROBABILITY Ke  ({VIMG 20,26 tent2})  100}
{BUILDING             Kud ({VIMG 36,40 dwarven-keep}) }


#
#       > N O R M A L   T R A N S I T I O N S. < 

#The order mostly controls which overlap which, some
# TERRAIN_ADJACENT_CUSTOMs and varying layer numbers are used to make some
# special transitions to layer in more complex ways.

{TERRAIN_ADJACENT          -140    (Mm,Hh,Ha,Ff,Fa,Fet)                 Chr              grassland}

{TERRAIN_ADJACENT_CUSTOM   -150    (Mm,Vhm,Xm)      (Ha,Aa,Hd,Vud,W*,B*,Vwm,Vs,Ss)       mountains transition2}
{TERRAIN_ADJACENT_CUSTOM   -151    (Mm,Vhm,Xm)      (!,Mm,Vhm,Qxu,Hh,C*,K*,_K,Xu)        mountains transition2}
{TERRAIN_ADJACENT          -160    Md               (!,Md,Qxu)                           desert-mountains}


{TERRAIN_ADJACENT          -170    (Ha,Vhha)        (W*,B*,Vwm,Vs,Ss)                    snow-hills-to-water}
{TERRAIN_ADJACENT          -171    (Ha,Vhha)        (Hh,Vhh)                             snow-hills-to-hills}
{TERRAIN_ADJACENT          -172    (Ha,Vhha)        (!,Ha,Vhha,Qxu)                      snow-hills}
{TERRAIN_ADJACENT          -180    Hd               (!,Hd,Qxu)                           desert-hills}
{TERRAIN_ADJACENT          -190    (Hh,Vhh)         (!,Hh,Vhh,W*,B*,Vwm,Vs,Ss)           hills}
{TERRAIN_ADJACENT_CUSTOM   -191    (Hh,Vhh)         (W*,B*,Vwm,Vs,Ss)                    hills transition2}
{TERRAIN_ADJACENT          -200    Uh               (!,Uh)                               cave-hills}

{TERRAIN_ADJACENT          -210    (U*,Vu*)         (!,U*,Vu*)                           cave-floor}
{TERRAIN_ADJACENT          -220    Ql               (!,Ql,Qxu,Xu)                        lava}
{TERRAIN_ADJACENT          -230    (Fa,Aa,Vha,Vea)  (W*,B*,Vwm,Vs,Ss)                    snow-to-water}
{TERRAIN_ADJACENT          -240    (Fa,Aa,Vha,Vea)  (!,Fa,Aa,Vha,Vea,Qxu)                snow}
{TERRAIN_ADJACENT          -260    (Ft,Gs,Vht)      (W*,B*,Vwm)                          savanna-to-water}

{TERRAIN_ADJACENT          -250    (Ss,Vs,Chs,Bss*)      (!,Ss,Vss,Chs,H*,M*,Vhh*,Vhm,Xm,Bss*)     swampwater}


# These two work in conjunction with the mountain and hill transitions to create
# a smooth coastline between grassland, hills and mountains.

{TERRAIN_ADJACENT          -270    (Ff,Gg,Veg,Vhg,Fet,Qxu)  (!,Ff,Gg,Veg,Vhg,Fet,Qxu,Mm,Vhm,Xm,Hh,Vha,W*,B*,Vwm,Vss,Ss) grassland}
{TERRAIN_ADJACENT          -319    (Ff,Gg,Veg,Vhg,Fet,Qxu,Mm,Vhm,Hh,Vhh,Xm)   (W*,B*,Vwm)   grassland-to-water}

{TERRAIN_ADJACENT          -280    (Gs,Ft,Vht)          (!,Gs,Ft,Vht,Qxu)                savanna}
{TERRAIN_ADJACENT          -290    Rr                   (!,Rr)                           road}
{TERRAIN_ADJACENT          -259    Re                   (!,Re)                           dirt}
{TERRAIN_ADJACENT          -310    Rd                   (!,Rd)                           desert-road}
{TERRAIN_ADJACENT          -320    (Dd,Do,Vda)          (!,Dd,Do,Vda)                    desert-oasis}
{TERRAIN_ADJACENT          -330    (Dc,Dd,Dr,Do,Vd*)    (!,Dc,Dd,Dr,Do,Vd*)              desert}
{TERRAIN_ADJACENT          -340    Ds                   (!,Ds)                           sand}


#{SET_ADJACENT_FLAG         (Chs,Chr)  _K            Ai                                   transition2}


# Water Transitions draw below everything else

{SET_ADJACENT_FLAG         (Chs,Chr)  _K            (W*,B*,Vwm,Vs)                     transition2}
{TERRAIN_ADJACENT_CUSTOM   -500    (Ch,Ce,Chr,Cud,Kh,Ke,Khr,Kud,_K)  (Ai,W*,B*,Vwm)    castle-to-ice transition3}
{TERRAIN_ADJACENT_CUSTOM   -505    (Ch,Ce,Chr,Cud,Kh,Ke,Khr,Kud,_K)   (W*,B*,Vwm)      castle-to-water transition2}
{TERRAIN_ADJACENT_CUSTOM   -510    Ai               (W*,B*,Vwm,Vs,Ss)  ice-to-water    submerged_part}
{TERRAIN_ADJACENT          -503    Ai               (!,Ai,Qxu)                           ice}

{TERRAIN_ADJACENT          -520    (Ww,Vwm,Bww*)    (!,Ww,Vwm,Bww*,Mm)                   coast}
{TERRAIN_ADJACENT          -530    Wwf              (!,Wwf)                              ford}
{TERRAIN_ADJACENT          -540    (Wo,Bwo*)        (!,Wo,Bwo*)                          ocean}
{TERRAIN_ADJACENT_CUSTOM   -550    Chw              (Ch,Chr)             sunken-ruin     transition2}
{TERRAIN_ADJACENT_CUSTOM   -550    Chs              (Ch,Chr)             swampwater      transition2}
{TERRAIN_ADJACENT          -560    Chw              (!,Chw,Chr)                          coast}
{TERRAIN_ADJACENT          -570    (!,Chr,Chw)      Chr                                  grassland}

{TERRAIN_BASE_DEFAULT void}
