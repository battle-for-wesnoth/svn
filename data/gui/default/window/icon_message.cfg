#textdomain wesnoth-lib
###
### The in game portrait dialogs.
### Due to the excessive amount of dialogs it's not possible to split off the 
### window definitions. So this unit is a bit larger as wanted.
###

# These might become global have to evaluate later.
#define _GUI_HEIGHT_OFFSET
	25#enddef

# helper convert the scale factor, since we use it in two places define it as
# helper value. (Two the not working and working version, but want to avoid
# surprises when the not working version is fixed).
#define __GUI_SIZE_FACTOR
	3#enddef

# This is the function I want to use for the image width, but the formula system
# has no way to create variables (outside the AI scope). So instead of this
# macro there's a more verbose version which doesn't use variable.

#define __GUI_IMAGE_WIDTH
([
	max_height = screen_height - {_GUI_HEIGHT_OFFSET},
	best_width = gamemap_width / {__GUI_SIZE_FACTOR},
	best_width = if(best_width > max_height, max_height, best_width),
	if(best_width < 250, 250,
		if(best_width > 500, 500, best_width))
][4])#enddef

#undef __GUI_IMAGE_WIDTH

###
### The verbose version
###

#define __GUI_MAX_HEIGHT
(screen_height - {_GUI_HEIGHT_OFFSET})
#enddef

#define BEST_WIDTH
(gamemap_width / {__GUI_SIZE_FACTOR})
#enddef

#define __GUI_BEST_SIZE
(if({BEST_WIDTH} > {__GUI_MAX_HEIGHT}, {__GUI_MAX_HEIGHT}, {BEST_WIDTH}))
#enddef

#define ___GUI_IMAGE_WIDTH
	if({__GUI_BEST_SIZE} < 250, 250,
		if({__GUI_BEST_SIZE} > 500, 500, {__GUI_BEST_SIZE})
	)
#enddef

# This is the version with debug info
#define __GUI_IMAGE_WIDTH
([[
	debug_print('screen_width ', screen_width),
	debug_print('screen_height ', screen_height),
	debug_print('__GUI_MAX_HEIGHT ', {__GUI_MAX_HEIGHT}),
	debug_print('BEST_WIDTH ', {BEST_WIDTH}),
	debug_print('__GUI_BEST_SIZE ', {__GUI_BEST_SIZE})
],
	{___GUI_IMAGE_WIDTH}
][1]
)
#enddef

#undef __GUI_IMAGE_WIDTH
# This is the version without debug info
#define __GUI_IMAGE_WIDTH
({___GUI_IMAGE_WIDTH})#enddef	


# This is the macro for the image width which is can be used as string
# parameter.
#define _GUI_IMAGE_WIDTH
"{__GUI_IMAGE_WIDTH}"#enddef

# the value the image needs to be scaled by, this version can be used as string
# parameter.
#define _GUI_IMAGE_SCALE_FACTOR
(
	{__GUI_IMAGE_WIDTH} / 500
)#enddef


# The formula to set the widthe of the real image width depending on the
# image real size
#define __GUI_IMAGE_DISPLAYED_WIDTH
(
	if((image_original_width < 300) and (image_original_height < 300), 
		image_original_width, 
		((image_original_width * {__GUI_IMAGE_WIDTH}) / 500))
)#enddef

# The formula to set the heighte of the real image height depending on the
# image real size
#define __GUI_IMAGE_DISPLAYED_HEIGHT
(
	if((image_original_width < 300) and (image_original_height < 300), 
		image_original_height, 
		((image_original_height * {__GUI_IMAGE_WIDTH}) / 500))
)#enddef

# The X location of the image to display, only tested on the left side.
#define __GUI_IMAGE_DISPLAYED_X X
(
	if(image_original_width > 100,
		{X},
		({__GUI_IMAGE_WIDTH} - image_width) / 2)

)#enddef

# The Y location of the image to display, only tested on the left side.
# Note since we don't know the exact height of the text we can't centre
# the image. Instead we use the centre of the reserved image space.
#
# TODO the Y can't be determined properly since we don't know the height
# of the panel. Disabled the centring for now.
#
#define __GUI_IMAGE_DISPLAYED_Y
(
	if(image_original_height > 0,
		(height - image_height),
		height - (({__GUI_IMAGE_WIDTH} - image_height) / 2))

)#enddef

#define UNIT_BUTTONS
#    [row]
        [column]	
	    border = "all"
	    border_size = 5
	    horizontal_alignment = "center"

	    [button]
		# This button will be shown or hidden depending on the
		# whether or not a sellection may be avoided	
		id = "profile"
		definition = "transparent"

		label = "_ Profile"
	    [/button]
	[/column]
#    [/row]
#enddef

#define CANCEL_BUTTON
#    [row]
        [column]	
	    border = "all"
	    border_size = 5
	    horizontal_alignment = "center"

	    [button]
		# This button will be shown or hidden depending on the
		# whether or not a sellection may be avoided	
		id = "cancel"
		definition = "transparent"

		label = "_ Cancel"
	    [/button]
	[/column]
#    [/row]
#enddef

#define HELP_BUTTON
#    [row]
        [column]	
	    border = "all"
	    border_size = 5
	    horizontal_alignment = "center"

	    [button]
		# This button will be shown or hidden depending on the
		# whether or not a sellection may be avoided	
		id = "help"
		definition = "transparent"

		label = "_ Help"
	    [/button]
	[/column]
#    [/row]
#enddef

#define RECALL_BUTTONS
    #	[row]
    #		[column]	
    #			border = "all"
    #			border_size = 5
    #			horizontal_alignment = "center"

    #			[button]
    #			#TODO correct comment
    #				# This button will be shown or hidden depending on the
    #				# whether or not a selection may be avoided				
    #				id = "recall"
    #				definition = "transparent"

    #				label = "_ Recall"
    #			[/button]
    #		[/column]
    #	[/row]
#    [row]
	[column]	
	    border = "all"
	    border_size = 5
	    horizontal_alignment = "center"

	    [button]
		# This button will be shown or hidden depending on the
		# whether or not a selection may be avoided				
		id = "remove"
		definition = "transparent"

		label = "_ Remove"
	    [/button]
	[/column]
 #   [/row]
#enddef


#define _GUI_INPUT
    [row]

	[column]
	    grow_factor = 1
	    horizontal_grow = "true"

	    [grid]

		[row]

		    [column]
			border = "all"
			border_size = 5

			[label]
			    id = "input_caption"
			    definition = "default"
			[/label]

		    [/column]

		    [column]
			grow_factor = 1
			horizontal_grow = "true"

			border = "all"
			border_size = 5

			[text_box]
			    id = "input"
			    definition = "default"
			[/text_box]

		    [/column]

		[/row]

	    [/grid]

	[/column]

    [/row]
#enddef




#define MESSAGE_WINDOW ID INPUT BUTTONS
    [window_definition]
	id = "{ID}_left"
	description = "bar"

	[resolution]

	    [background]

		[draw]

		[/draw]

	    [/background]

	    [foreground]

		[draw]

		    [image]
			x = "{__GUI_IMAGE_DISPLAYED_X X}"
			y = "{__GUI_IMAGE_DISPLAYED_Y}"
			w = "{__GUI_IMAGE_DISPLAYED_WIDTH}"
			h = "{__GUI_IMAGE_DISPLAYED_HEIGHT}"
			name = "(portrait_image)"
			vertical_mirror = "(portrait_mirror)"
		    [/image]

		[/draw]

	    [/foreground]

	[/resolution]

    [/window_definition]

    [window_definition]
	id = "{ID}_right"
	description = "bar"

	[resolution]

	    [background]

		[draw]

		[/draw]

	    [/background]

	    [foreground]

		[draw]

		    [image]
			x = "(width - {__GUI_IMAGE_DISPLAYED_WIDTH})"
			y = "(height - image_height)"
			w = "{__GUI_IMAGE_DISPLAYED_WIDTH}"
			h = "{__GUI_IMAGE_DISPLAYED_HEIGHT}"
			name = "(portrait_image)"
			vertical_mirror = "(portrait_mirror)"
		    [/image]

		[/draw]

	    [/foreground]

	[/resolution]

    [/window_definition]

    [window]
	id = "{ID}_left"
	description = "Dialog showing a unit portrait on the left side"

	[resolution]
	    window_width = 0
	    window_height = 0

	    definition = "{ID}_left"

	    automatic_placement = "false"

	    x = 0
	    y = 30
	    width = "(gamemap_width)"
	    height = "(screen_height - 30)"

	    click_dismiss = "true"

	    [linked_group]
		id = "icon"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "label"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "description"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "traits"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "xp"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "type"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "cost"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "level"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "name"
		fixed_width = "true"
	    [/linked_group]

		[linked_group]
		id = "usage"
		fixed_width = "true"
	    [/linked_group]

	    [grid]

		[row]

		    [column]
			vertical_alignment = "bottom"
			horizontal_grow = "true"

			[panel]
			    definition = "wml_message"

			    [grid]

				[row]

				    [column]
					horizontal_grow = "true"

					[grid]

					    [row]

						[column]

						    [spacer]
							# reserve place for the image and set a minimum height for the text
							id = "image_place_holder"

							width = {_GUI_IMAGE_WIDTH}
							height = 75
						    [/spacer]

						[/column]

						[column]
						    grow_factor = 1
						    horizontal_grow = "true"

						    [grid]

							[row]

							    [column]
								border = "all"
								border_size = 5
								horizontal_alignment = "left"

								[label]
								    id = "title"
								    definition = "title"
								[/label]

							    [/column]

							[/row]

							[row]

							    [column]
								grow_factor = 1
								horizontal_grow = "true"

								border = "all"
								border_size = 5

								[scroll_label]
								    id = "message"
								    definition = "wml_message"
								[/scroll_label]

							    [/column]

							[/row]

					                {INPUT}
                                                        
							[row]

							    [column]

                                                                [grid]
                                                                    
                                                                    [row]
                                                                        {BUTTONS}
                                                                        [column]
								            border = "all"
								            border_size = 5
								            horizontal_alignment = "center"
                                                                            
								            [button]
								                # This button will be shown or hidden depending on the
								                # whether or not a scrollbar is needed to show the
								                # text.
								                id = "ok"
								                definition = "transparent"
                                                                                
								                label = "_ OK"
                                                                                
								            [/button]
                                                                        [/column]
                                                                    [/row]
                                                                    
                                                                [/grid]
                                                                
							    [/column]

							[/row]

						    [/grid]

						[/column]

						[column]

						    [spacer]
							width = "(
if(gamemap_width - ({__GUI_IMAGE_WIDTH}) > 675
, gamemap_width - (({__GUI_IMAGE_WIDTH}) + 675)
, 0
))"
							height = 75
						    [/spacer]

						[/column]

					    [/row]

					[/grid]

				    [/column]

				[/row]

			    [/grid]

			[/panel]

		    [/column]

		[/row]

	    [/grid]

	[/resolution]

    [/window]






    #	{BUTTONS}

    #	[row]

    #	    [column]
    #		border = "all"
    #		border_size = 5
    #		horizontal_alignment = "center"

    #		[button]
    # This button will be shown or hidden depending on the
    # whether or not a scrollbar is needed to show the
    # text.
    #		    id = "ok"
    #		    definition = "transparent"

    #		    label = "_ OK"
    #		[/button]

    #	    [/column]

    #	[/row]
    #                                                       [row]
    #			                        #            [column]
    #                [grid]
    #                    [row]
    #  [column]
    #		                    [button]
    #				id = "help"
    #			definition = "transparent"
    #		label = "_ Help"
    #
    #						                    [/button]
    #				                        [/column]
    #			                        [column]
    #			                    [spacer]
    #			                # reserve place for the image and set a minimum height for the text
    #				id = "_place_holdeththtr"
    #
    #									width = 5#{_GUI_IMAGE_WIDTH}
    #								height = 75
    #					                # 4.1 - 2.1
    #			                    [/spacer]
    #	                        [/column]
    #                        [column]
    #                    [button]
    #		id = "profile"
    #	definition = "transparent"
    #label = _ "Profile"
    # 4.1 - 2.3
    #   [/button]
    #   [/column]
    #                       [column]
    #                    [spacer]
    # reserve place for the image and set a minimum height for the text
    #		id = "_placehththt_holder"

    #	width = 50#{_GUI_IMAGE_WIDTH}
    #height = 75
    # 4.1 - 2.1
    #    [/spacer]

    #     [/column]
    #					                        [column]
    #					                    [button]
    #							id = "ok"
    #						definition = "transparent"
    #
    #									label = _ "OK"
    #						                # 4.1 - 2.2
    #				                    [/button]
    #		                        [/column]
    #       [column]
    #           [spacer]
    #               # reserve place for the image and set a minimum height for the text
    #		id = "_plghtace_holder"
    #
    #									width = 5#{_GUI_IMAGE_WIDTH}
    #								height = 75
    # 4.1 - 2.1
    #				                    [/spacer]
    #		                        [/column]
    #	                        [column]
    #	                    [button]
    #			id = "cancel"
    #		definition = "transparent"
    #
    #									label = _ "Cancel"
    #						                # 4.1 - 2.3
    #				                    [/button]
    #		                        [/column]
    #[/row]
    # [/grid]
    #[/column]


    #TODO the right window is not set up correctly.
    [window]
	id = "{ID}_right"
	description = "Dialog showing a unit portrait on the right side"

	[resolution]
	    window_width = 0
	    window_height = 0

	    definition = "{ID}_right"

	    automatic_placement = "false"

	    x = 0
	    y = 30
	    width = "(gamemap_width)"
	    height = "(screen_height - 30)"

	    click_dismiss = "true"

	    [linked_group]
		id = "icon"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "label"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "description"
		fixed_width = "true"
	    [/linked_group]

	    [linked_group]
		id = "cost"
		fixed_width = "true"
	    [/linked_group]


	    [grid]

		[row]

		    [column]
			vertical_alignment = "bottom"
			horizontal_grow = "true"

			[panel]
			    definition = "wml_message"
			    

			    [grid]

				[row]

				    [column]
					horizontal_grow = "true"

					[grid]

					    [row]

						[column]

						    [spacer]
							width = 10
							height = 75
						    [/spacer]

						[/column]

						[column]
						    grow_factor = 1
						    horizontal_grow = "true"

						    [grid]

							[row]

							    [column]
								border = "all"
								border_size = 5
								horizontal_alignment = "left"

								[label]
								    id = "title"
								    definition = "title"
								[/label]

							    [/column]

							[/row]

							[row]

							    [column]
								grow_factor = 1
								horizontal_grow = "true"

								border = "all"
								border_size = 5

								[scroll_label]
								    id = "message"
								    definition = "default"
								[/scroll_label]

							    [/column]

							[/row]

							{INPUT}

							#	[row]
                                                        #
                                                        #														[column]
                                                        #															border = "all"
                                                        #															border_size = 5
                                                        #															horizontal_grow = "true"
                                                        #
                                                        #															{_GUI_INPUT_LIST}
                                                        #
                                                        #														[/column]
                                                        #
                                                        #													[/row]

							[row]

							    [column]
								border = "all"
								border_size = 5
								horizontal_alignment = "center"

								[button]
								    # This button will be shown or hidden depending on the
								    # whether or not a scrollbar is needed to show the
								    # text.
								    id = "ok"
								    definition = "transparent"

								    label = "_ OK"
								[/button]

							    [/column]

							[/row]

						    [/grid]

						[/column]

						[column]

						    [spacer]
							width = "(
if(gamemap_width - (10 + ({__GUI_IMAGE_WIDTH})) > 675
, gamemap_width - (10 + ({__GUI_IMAGE_WIDTH}) + 675)
, 0
))"
							height = 75
						    [/spacer]

						[/column]

						[column]

						    [spacer]
							# reserve place for the image and set a minimum height for the text
							id = "image_place_holder"

							width = {_GUI_IMAGE_WIDTH}
							height = 75
						    [/spacer]

						[/column]


					    [/row]

					[/grid]

				    [/column]

				[/row]

			    [/grid]

			[/panel]

		    [/column]

		[/row]

	    [/grid]

	[/resolution]

    [/window]
#enddef


#define _GUI_TYPE_LIST
    [row]

        [column]
            border = "all"
            border_size = 5
            horizontal_grow = "true"


            [listbox]
	        id = "unit_list"
	        definition = "wml_message"
	        [list_definition]

		    [row]

			[column]
			    grow_factor = 1
			    horizontal_grow = "true"

			    [toggle_panel]
				definition = "wml_message"

				return_value_id = "ok"
				[grid]

				    [row]

					[column]
					    grow_factor = 0
					    horizontal_alignment = "left"

					    border = "all"
					    border_size = 5

					    [image]
						id = "icon"
						definition = "default"
						linked_group = "icon"
					    [/image]

					[/column]

					[column]
					    grow_factor = 0
					    horizontal_alignment = "left"

					    border = "all"
					    border_size = 5

					    [label]
						id = "type"
						definition = "default"
						linked_group = "type"
					    [/label]

					[/column]

					[column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "cost"
						definition = "default"
						linked_group = "cost"
					    [/label]

					[/column]

                    [column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "usage"
						definition = "default"
						linked_group = "usage"
					    [/label]

					[/column]

				    [/row]

				[/grid]

			    [/toggle_panel]

			[/column]

		    [/row]

	        [/list_definition]

            [/listbox]
        [/column]
    [/row]
#enddef

#define _GUI_UNIT_LIST
    [row]

	[column]
	    border = "all"
	    border_size = 5
	    horizontal_grow = "true"

            [listbox]
	        id = "unit_list"
	        definition = "wml_message"
	        [list_definition]

		    [row]

			[column]
			    grow_factor = 1
			    horizontal_grow = "true"

			    [toggle_panel]
				definition = "wml_message"

				return_value_id = "ok"
				[grid]

				    [row]

					[column]
					    grow_factor = 0
					    horizontal_alignment = "left"

					    border = "all"
					    border_size = 5

					    [image]
						id = "icon"
						definition = "default"
						linked_group = "icon"
					    [/image]

					[/column]

					[column]
					    grow_factor = 0
					    horizontal_alignment = "left"

					    border = "all"
					    border_size = 5

					    [label]
						id = "type"
						definition = "default"
						linked_group = "type"
					    [/label]

					[/column]

					[column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "name"
						definition = "default"
						linked_group = "name"
					    [/label]

					[/column]

					[column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "level"
						definition = "default"
						linked_group = "level"
					    [/label]

					[/column]

					[column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "xp"
						definition = "default"
						linked_group = "xp"
					    [/label]

					[/column]

					[column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "traits"
						definition = "default"
						linked_group = "traits"
					    [/label]

					[/column]
				    [/row]

				[/grid]

			    [/toggle_panel]

			[/column]

		    [/row]

	        [/list_definition]

            [/listbox]
        [/column]
    [/row]
#enddef

#define _GUI_OPTION_LIST
    [row]

	[column]
	    border = "all"
	    border_size = 5
	    horizontal_grow = "true"

            [listbox]
	        id = "input_list"
	        definition = "wml_message"
	        [list_definition]

		    [row]

			[column]
			    grow_factor = 1
			    horizontal_grow = "true"

			    [toggle_panel]
				definition = "wml_message"

				return_value_id = "ok"
				[grid]

				    [row]

					[column]
					    grow_factor = 0
					    horizontal_alignment = "left"

					    border = "all"
					    border_size = 5

					    [image]
						id = "icon"
						definition = "default"
						linked_group = "icon"
					    [/image]

					[/column]

					[column]
					    grow_factor = 0
					    horizontal_alignment = "left"

					    border = "all"
					    border_size = 5

					    [label]
						id = "label"
						definition = "default"
						linked_group = "label"
					    [/label]

					[/column]

					[column]
					    grow_factor = 1
					    horizontal_grow = "true"

					    border = "all"
					    border_size = 5

					    [label]
						id = "description"
						definition = "default"
						linked_group = "description"
					    [/label]

					[/column]

				    [/row]

				[/grid]

			    [/toggle_panel]

			[/column]

		    [/row]

	        [/list_definition]

            [/listbox]
        [/column]
    [/row]
#enddef

{MESSAGE_WINDOW icon_message () ()}
{MESSAGE_WINDOW input_message ({_GUI_INPUT}) ()}
{MESSAGE_WINDOW option_message ({_GUI_OPTION_LIST}) ()}
{MESSAGE_WINDOW unit_message ({_GUI_UNIT_LIST}) ({UNIT_BUTTONS})}
{MESSAGE_WINDOW recruit_message ({_GUI_TYPE_LIST}) ({HELP_BUTTON} {UNIT_BUTTONS}
{CANCEL_BUTTON}) }
{MESSAGE_WINDOW recall_message ({_GUI_UNIT_LIST}) ({HELP_BUTTON}
{RECALL_BUTTONS}
{UNIT_BUTTONS}
{CANCEL_BUTTON}) }

#undef _GUI_INPUT_LIST
#undef _GUI_UNIT_LIST
#undef _GUI_INPUT
#undef _GUI_TYPE_LIST
#undef _GUI_OPTION_LIST

#undef __GUI_IMAGE_DISPLAYED_Y
#undef __GUI_IMAGE_DISPLAYED_X
#undef __GUI_IMAGE_DISPLAYED_HEIGHT
#undef __GUI_IMAGE_DISPLAYED_WIDTH
#undef _GUI_IMAGE_SCALE_FACTOR
#undef _GUI_IMAGE_WIDTH
#undef __GUI_IMAGE_WIDTH
#undef ___GUI_IMAGE_WIDTH
#undef __GUI_BEST_SIZE
#undef __GUI_MAX_HEIGHT
#undef __GUI_SIZE_FACTOR
#undef _GUI_HEIGHT_OFFSET

