#textdomain wesnoth
# This file contains macros useful for debugging and testing purposes.

#define DEBUG_MSG MESSAGE_TEXT
    # Emit a debug message.  Meant to be overridden with no-op definition
    # of the same name for production use.
    [message]
        speaker=narrator
        message={MESSAGE_TEXT}
        image=wesnoth-icon.png
    [/message]
#enddef

#define TIME_ACTIONS CONTENT_WML
    # Messing with the variable is annoying, so I'll deprecate this in favour of
    # TIMED_ACTIONS (below)
    {DEPRECATE TIME_ACTIONS 1.9.4}

    # Measure (in milliseconds) the time arbitrary event WML takes to
    # execute.  Afterwards, the time the enclosed WML took to execute
    # is found in the variable $timed_actions_ms.
    #
    # Example:
    #! [event]
    #!     name=start
    #!
    #!     {TIME_ACTIONS (
    #!         {MODIFY_UNIT race=orc name ( _ "Azir")}
    #!     )}
    #!
    #!     {DEBUG_MSG "Renaming all orcs to Azir took $timed_actions_ms|ms."}
    #! [/event]
    {VARIABLE_OP TIME_ACTIONS_time_begin time stamp}

    {CONTENT_WML}

    {VARIABLE_OP TIME_ACTIONS_time_end time stamp}

    {VARIABLE timed_actions_ms $TIME_ACTIONS_time_end}
    {VARIABLE_OP timed_actions_ms add "-$TIME_ACTIONS_time_begin"}

    {CLEAR_VARIABLE TIME_ACTIONS_time_begin}
    {CLEAR_VARIABLE TIME_ACTIONS_time_end}
#enddef

#define TIMED_ACTIONS TITLE CONTENT_WML
    # Measure (in milliseconds) the time arbitrary event WML takes to
    # execute.
    #
    # Example:
    #! [event]
    #!     name=start
    #!
    #!     {TIME_ACTIONS "orc renaming" (
    #!         {MODIFY_UNIT race=orc name ( _ "Azir")}
    #!     )}
    #! [/event]
    {VARIABLE_OP TIME_ACTIONS_time_begin time stamp}

    {CONTENT_WML}

    {VARIABLE_OP TIME_ACTIONS_time_end time stamp}

    [message]
        speaker=narrator
        caption={TITLE}
        message="$($TIME_ACTIONS_time_end - $TIME_ACTIONS_time_begin) milliseconds."
    [/message]

    {CLEAR_VARIABLE TIME_ACTIONS_time_begin,TIME_ACTIONS_time_end}
#enddef