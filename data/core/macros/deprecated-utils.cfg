#textdomain wesnoth
# These are clutter, scheduled to be removed.

# ! in comments is used for generating HTML documentation, ignore it otherwise.

#wmllint: markcheck off
#define DEPRECATE MACRO_NAME VERSION_NAME
    # Tag macros for removal, the VERSION_NAME argument is the
    # release where the message is shown the first time.
    # The removal will be 2 versions later.
    [deprecated_message]
        message="Macro '" + {MACRO_NAME} + "' is scheduled for removal in Wesnoth " + {VERSION_NAME} + "."
    [/deprecated_message]
#enddef
#wmllint: markcheck on

#define ADD_HERO_ICON FILTER
    # Add hero icon to specified units
    {DEPRECATE ADD_HERO_ICON 1.7.2}
    [store_unit]
        [filter]
            {FILTER}
        [/filter]

        variable=MODIFY_UNIT_store
        kill=yes
    [/store_unit]

    {FOREACH MODIFY_UNIT_store MODIFY_UNIT_i}
        [set_variable]
            name=MODIFY_UNIT_store[$MODIFY_UNIT_i].overlays
            value="misc/hero-icon.png"
        [/set_variable]

        [unstore_unit]
            variable=MODIFY_UNIT_store[$MODIFY_UNIT_i]
            find_vacant=no
        [/unstore_unit]
    {NEXT MODIFY_UNIT_i}

    {CLEAR_VARIABLE MODIFY_UNIT_store}
#enddef

#define REMOVE_HERO_ICON FILTER
    # Remove the hero icon from a unit by ID or other filter
    {DEPRECATE REMOVE_HERO_ICON 1.7.2}
    [store_unit]
        [filter]
            {FILTER}
        [/filter]

        kill=no
        variable=hero_removal_target
    [/store_unit]

    [remove_unit_overlay]
        x,y=$hero_removal_target.x,$hero_removal_target.y
        image=misc/hero-icon.png
    [/remove_unit_overlay]

    [clear_variable]
        name=hero_removal_target
    [/clear_variable]
#enddef

#define NEUTRAL_SIDE SIDE
    # Allows a side to appear as if allied with every other side.
    #
    # Limitations: if we have three sides A, B and C, and C is a neutral side, then
    # sides B and C will appear as enemies during A's turn, and likewise A and C on
    # B's turn.
    #
    # IMPORTANT NOTE: the scenario needs victory_when_enemies_defeated=no to be set.
    [event]
        name=prestart

        [deprecated_message]
            message="Macro 'NEUTRAL_SIDE' is deprecated, use comma-separated teams in [side] team_name instead"
        [/deprecated_message]
        {VARIABLE NEUTRAL_SIDE_i 1}

        [store_side]
            side=$NEUTRAL_SIDE_i
            variable=NEUTRAL_SIDE_side_store
        [/store_side]

        [while]
            [variable]
                name=NEUTRAL_SIDE_side_store.team_name
                not_equals=$empty
            [/variable]

            [do]
                {VARIABLE side_$NEUTRAL_SIDE_i|_original_team_name $NEUTRAL_SIDE_side_store.team_name}
                {VARIABLE side_$NEUTRAL_SIDE_i|_original_user_team_name $NEUTRAL_SIDE_side_store.user_team_name}

                {VARIABLE_OP NEUTRAL_SIDE_i add 1}

                {CLEAR_VARIABLE NEUTRAL_SIDE_side_store}

                [store_side]
                    side=$NEUTRAL_SIDE_i
                    variable=NEUTRAL_SIDE_side_store
                [/store_side]
            [/do]
        [/while]

        {CLEAR_VARIABLE NEUTRAL_SIDE_side_store}
    [/event]

    [event]
        name=side turn
        first_time_only=no

        [if]
            [variable]
                name=side_number
                not_equals={SIDE}
            [/variable]

            [then]
                {VARIABLE NEUTRAL_SIDE_i 1}

                [while]
                    [variable]
                        name=side_$NEUTRAL_SIDE_i|_original_team_name
                        not_equals=$empty
                    [/variable]

                    [do]
                        [modify_side]
                            side=$NEUTRAL_SIDE_i
                            team_name=$side_$NEUTRAL_SIDE_i|_original_team_name
                            user_team_name=$side_$NEUTRAL_SIDE_i|_original_user_team_name
                        [/modify_side]

                        {VARIABLE_OP NEUTRAL_SIDE_i add 1}
                    [/do]
                [/while]

                [store_side]
                    side=$side_number
                    variable=NEUTRAL_SIDE_side_store
                [/store_side]

                [modify_side]
                    side={SIDE}
                    team_name=$NEUTRAL_SIDE_side_store.team_name
                    user_team_name=$side_{SIDE}_original_user_team_name
                [/modify_side]

                {CLEAR_VARIABLE NEUTRAL_SIDE_side_store}
            [/then]

            [else]
                {VARIABLE NEUTRAL_SIDE_i 1}

                [while]
                    [variable]
                        name=side_$NEUTRAL_SIDE_i|_original_team_name
                        not_equals=$empty
                    [/variable]

                    [do]
                        [modify_side]
                            side=$NEUTRAL_SIDE_i
                            team_name=friends_with_all
                            user_team_name=$side_$NEUTRAL_SIDE_i|_original_user_team_name
                        [/modify_side]

                        {VARIABLE_OP NEUTRAL_SIDE_i add 1}
                    [/do]
                [/while]
            [/else]
        [/if]
    [/event]
#enddef
