[scenario]
	id=Northern_Outpost
	textdomain=wesnoth-ei
	name= _ "Northern Outpost"
	map_data="{maps/Eastern_Invasion/Northern_Outpost}"
	turns=18

    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}

	next_scenario=Two_Paths
	victory_when_enemies_defeated=no

	music="wesnoth-3.ogg"

	objectives= _ "
Victory:
@Find the outlaw leader in the villages and kill him
Defeat:
#Death of Gweddry
#Death of Dacyn
#Death of Owaec"

	{scenarios/Eastern_Invasion/deaths.cfg}

	[story]
		[part]
			background=maps/eastern_invasion.png
			show_title=yes
			{CROSS 260 180}
		[/part]
	[/story]

	[side]
	race=Humans
	type=Lieutenant
	description=Gweddry
	side=1
	canrecruit=1
	recruit=Spearman,Cavalryman,Mage,Horseman,Heavy Infantryman
	controller=human
	team_name=good
	[/side]
	
	[side]
	race=Humans
	type=Mounted Captain
	description=Owaec
	side=2
	canrecruit=1
	recruit=Horseman,Bowman
	team_name=good
	{GOLD 200 150 100}
		[ai]
		{NO_SCOUTS}
			[avoid]
			x=1-32
			y=1-18
			[/avoid]
		[/ai]
	[/side]	

	[side]
	race=Undead
	type=Revenant
	description=Lanar-Skal
	side=3
	canrecruit=1
	recruit=Skeleton,Skeleton Archer
	team_name=evil
	{INCOME 5 10 15}
	{GOLD 20 30 40}
		[ai]
		aggression=-0.1
		[/ai]	
	[/side]

	[side]
	type=Assassin
	side=4
		[ai]
		grouping=no
		[/ai]
	[/side]

#define TRAPMAN UNIT
[unit]
type={UNIT}
side=4
x=$x1
y=$y1
[/unit]
#enddef

	[event]
	name=start
		[set_variable]
		name=trapdiff
		value=1
		[/set_variable]
		[recall]
		description=Dacyn
		[/recall]
		[message]
		description=Owaec
		id=msg_cmpgn_ei_06_01
		message= _ "Hail, Gweddry!"
		[/message]
		[message]
		description=Gweddry
		id=msg_cmpgn_ei_06_02
		message= _ "Hello. We have been forced from our positions. Do you think you can help us regain our outpost?"
		[/message]
		[message]
		description=Owaec
		id=msg_cmpgn_ei_06_03
		message= _ "I am not sure. There are bandits in this country, and I have been told that it is my duty to defeat them, and protect the local villages. Whenever I send out troops to defeat them, they end up being slaughtered before they get aid, and the bandits retreat into the villages. I cannot find a way to defeat them."
		[/message]
		[message]
		description=Dacyn
		id=msg_cmpgn_ei_06_04
		message= _ "I think I may be able to help you. I am a mage; I believe I will be able to cast a spell that will reveal them if you enter the villages. However, I won't be able to help you in battle."
		[/message]
		[message]
		description=Gweddry
		id=msg_cmpgn_ei_06_05
		message= _ "It is time to drive out some bandits. Dacyn, go cast your spell!"
		[/message]
		[message]
		description=Owaec
		id=msg_cmpgn_ei_06_05
		message= _ "I believe there is a leader behind these outlaws; kill him, and we will have defeated these bandits."
		[/message]

		[message]
		description=Lanar-Skal
		message= _ "Go, go far from here! But me and my kind will chase you, and kill you!"
		[/message]
		[store_unit]
			[filter]
			description=Dacyn
			[/filter]
		variable=dacyn
		kill=yes
		[/store_unit]
	[/event]
	
	[event]
	name=capture
	first_time_only=no
		#creates random enemies when you flag a village
		[filter]
		side=1
		[/filter]
		{RANDOM 0..10}
		[set_variable]
		name=random
		multiply=.5
		[/set_variable]
		[if]
			[variable]
			name=random
			less_than=$trapdiff
			[/variable]
			[then]
				[set_variable]
				name=numban
				random=0..3
				[/set_variable]
				[set_variable]
				name=numban
				add=$trapdiff
				[/set_variable]
				[while]
					[variable]
					name=numban
					greater_than=0
					[/variable]
					[do]
						{RANDOM Footpad,Thug,Thief,Poacher,Thug,Thief,Footpad,Thug,Thief,Poacher,Thug,Thief,Rogue,Bandit}
						{TRAPMAN $random}
						[set_variable]
						name=numban
						add=-1
						[/set_variable]
					[/do]
				[/while]
				{CLEAR_VARIABLE numban}
				[message]
				speaker=unit
				message= _ "They're here!"
				[/message]
			[/then]
			[else]
				[message]
				speaker=unit
				message= _ "No outlaws in this village."
				[/message]
			[/else]
		[/if]
		[set_variable]
		name=trapdiff
		add=.5
		[/set_variable]
		
		#decides if the badguy leader appears
		#badguy leader has less chance of appearing early on. (as in 0% chance for first 5 villages. :P)
		{RANDOM 4..10}
		[set_variable]
		name=random
		multiply=.5
		[/set_variable]
		[if]
			[variable]
			name=random
			less_than=$trapdiff
			[/variable]
			[then]
				[unit]
				type=Asssassin
				side=4
				x=$x1
				y=$y1
				description=Shodrano
				[/unit]
				[message]
				description=Shodrano
				message= _ "So, you have found my hiding place. Very well, I guess I will have to kill you!"
				[/message]
				[message]
				description=Owaec
				message= _ "Thats the bandit leader! Kill him, and we will have fufilled our duty!"
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
	name=die
		[filter]
		description=Shodrano
		[/filter]
		[message]
		description=Shodrano
		message= _ "You have defeated me! I can terrorize the villagers no more..."
		[/message]
		[message]
		description=Owaec
		message= _ "I have fufilled me duty to the villages. Now I suppose I can join you in your quest."
		[/message]
		[unstore_unit]
		variable=dacyn
		find_vacant=yes
		[/unstore_unit]
		[message]
		description=Dacyn
		message= _ "Good job! Now, we should move onward, north. The undead scout has warned us; we must get far away from these lands. I think we should go north, and try to reach Weldyn from a different route."
		[/message]
		[endlevel]
		[/endlevel]
	[/event]

[/scenario]
