[scenario]
	name=Evacuation
	id=Evacuation
	map_data="{maps/Eastern_Invasion/Evacuation}"
	turns=24
	next_scenario=Back_In_Wesnoth

	{DAWN}
	{MORNING}
	{AFTERNOON}
	{DUSK}
	{FIRST_WATCH}
	{SECOND_WATCH}

	music="wesnoth-2.ogg"

	objectives="
Victory:
@Get everyone possible across the river
@Destroy the bridge (everyone left on the wrong side of the river will die, including everyone left on your recall list)
Defeat:
#Death of Gweddry or leaving him on the wrong side of the river
#Death of Dacyn or leaving him on the wrong side of the river
#Death of Owaec or leaving him on the wrong side of the river"

	{scenarios/Eastern_Invasion/deaths.cfg}

# XXX add graphics
#	[bigmap]
#		image=misc/loymap.png
#		{DOT 280 160}
#		{CROSS 260 130}
#	[/bigmap]

	[side]
	type=Lieutenant
	description=Gweddry
	side=1
	canrecruit=1
	controller=human
	[/side]
	
	[side]
	type=Orcish Warlord
	description=Varrak-Klar
	side=2
	canrecruit=1
	controller=ai
	recruit=Orcish Warrior,Goblin Knight,Direwolf Rider
	{GOLD 100 150 200}
	{INCOME 100 120 140}
	[/side]
	
	[side]
	type=Troll Warrior
	description=Unhk
	side=3
	canrecruit=1
	controller=ai
	recruit=Troll,Troll Warrior,Goblin Pillager
	{GOLD 100 150 200}
	{INCOME 80 100 120}
	[/side]

	[side]
	type=Orcish Warlord
	description=Ran-Lar
	side=4
	canrecruit=1
	controller=ai
	recruit=Orcish Crossbowman,Orcish Slayer,Orcish Warrior
	{GOLD 150 200 300}
	{INCOME 120 140 160}		
	[/side]

#define STORE_GUY D
[store_unit]
	[filter]
	description={D}
	[/filter]
variable={D}
kill=yes
[/store_unit]
#enddef

	[event]
	name=prestart
		[recall]
		description=Dacyn
		[/recall]
		[recall]
		description=Owaec
		[/recall]
		#recall the two people you got in captured
		[recall]
		description=Ranged
		[/recall]
		[recall]
		description=Melee
		[/recall]
		#store everyone
		{STORE_GUY Gweddry}
		{STORE_GUY Dacyn}
		{STORE_GUY Owaec}
		{STORE_GUY Melee}
		{STORE_GUY Ranged}
	[/event]

#define MOVE_GUY D X Y
[move_unit_fake]
type=${D}.type
x={X}
y={Y}
[/move_unit_fake]
[unstore_unit]
variable={D}
[/unstore_unit]
#enddef

	[event]
	name=start
		#move people in
		{MOVE_GUY Gweddry 22,21,20,19,18,17,16 5}
		{MOVE_GUY Owaec 24,23,22,21,20,19,18,17,16,15 25,25,25,25,25,25,25,25,25,26}
		{MOVE_GUY Dacyn 23,23,22,21,20,19,18,17,16 23,24,24,24,24,24,24,24,23}
		{MOVE_GUY Melee 23,22,21,20,19,18,17,16,15 25}
		{MOVE_GUY 25,24,23,22,21,20,19,18,17 24,24,24,25,25,25,25,25,25}
		#create a mage with a special description
		[unit]
		description=Engineer
		type=Mage
		x,y=15,23
		side=1
		[/unit]
		[message]
		description=Dacyn
		id=msg_cmpg_ei_15_01
		message=What? Who are you?
		[/message]
		[message]
		description=Engineer
		id=msg_cmpg_ei_15_02
		message="I'm a engineer. I suspect you'll have a need of me services. I bet you're gonna want me to blow up that bridge ov'r theah."
		[/message]
		[message]
		description=Owaec
		id=msg_cmpg_ei_15_03
		message=Um... why would we want to do that?
		[/message]
		[message]
		description=Engineer
		id=msg_cmpg_ei_15_04
		message="Well, i see those arcs are chasin' you, and if I blow up the bridge, they can't get across. It'll help you escape."
		[/message]
		[message]
		description=Dacyn
		id=msg_cmpg_ei_15_05
		message="Gweddry, he's actually right... it might be useful to hire him. How much?"
		[/message]
		[message]
		description=Engineer
		id=msg_cmpg_ei_15_06
		message="Fifty gold pieces."
		[/message]
		[message]
		description=Gweddry
		id=msg_cmpg_ei_15_07
		message="Very well, but you only get it once the bridge is down."
		[/message]
		[message]
		description=Engineer
		id=msg_cmpg_ei_15_08
		message="Deal. I c'n blow'er up once i get to that signpost ov'r 'ere. Thats where my eq'pment is."
		[/message]
		[message]
		description=Dacyn
		id=msg_cmpg_ei_15_09
		message="Unfortunately, anyone we leave on this side of the river will die. We have to get as many people as possible across before its too late..."
		[/message]
		[item]
		image=terrain/signpost.png
		x,y=20,8
		[/item]
	[/event]
	
#define NORTH_OF_BRIDGE
[not]
x=1-31,1-20
y=21-24,18-20
[/not]
#enddef

	[event]
	name=moveto
	first_time_only=no
		[filter]
		x,y=20,8
		description=Engineer
		[/filter]
		[message]
		description=Engineer
		id=msg_cmpg_ei_15_10
		message="So, d'ya want me to blow up der bridge yet, Cap'n?"
			[option]
			name=Yes
				[command]
					[message]
					description=Engineer
					id=msg_cmpg_ei_15_10
					message="Alright! Blast'n time!"
					[/message]
					[message]
					speaker=narrator
					id=msg_cmpg_ei_15_11
					message="BOOM!!!"
					[/message]
					[message]
					description=Engineer
					id=msg_cmpg_ei_15_12
					message="Well, i'm done 'ere. I believe you owe me some money?"
					[/message]
					[if]
						[have_unit]
						description=Gweddry
						{NORTH_OF_BRIDGE}
						[/have_unit]
						[then]
							[message]
							description=Gweddry
							id=msg_cmpg_ei_15_13
							message="Oops... i'm north of the bridge! That was bad planning on my part."
							[/message]
							[endlevel]
							result=defeat
							[/endlevel]
						[/then]
						[else]		
							[message]
							description=Gweddry
							id=msg_cmpg_ei_15_14
							message="Yeah, here you go. Now get out of here."
							[/message]
							[gold]
							amount=-50
							[/gold]
						[/else]
					[/if]
					[kill]
					description=Engineer
					[/kill]
					[if]
						[have_unit]
						description=Dacyn
						{NORTH_OF_BRIDGE}
						[/have_unit]
						[then]
							[message]
							description=Dacyn
							id=msg_cmpg_ei_15_15
							message="You idiot! You left me north of the bridge!"
							[/message]
							[endlevel]
							result=defeat
							[/endlevel]
						[/then]
					[/if]
					[if]
						[have_unit]
						description=Owaec
						{NORTH_OF_BRIDGE}
						[/have_unit]
						[then]
							[message]
							description=Owaec
							id=msg_cmpg_ei_15_16
							message="I'm still north of the bridge, Gweddry! Why'd you blow it up!?!"
							[/message]
							[endlevel]
							result=defeat
							[/endlevel]
						[/then]
					[/if]
					[kill]
					{NORTH_OF_BRIDGE}
					[/kill]
					[endlevel]
					result=victory
					bonus=yes
					[/endlevel]
				[/command]
			[/option]
			[option]
			name=No
				[command]
					[message]
					description=Engineer
					id=msg_cmpg_ei_15_17
					message="Neh? Alright then, we'll wait fa' later, eh?"
					[/message]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
	name=time over
		[message]
		description=Dacyn
		id=msg_cmpg_ei_15_18
		message=We have not thrown down the bridge in time! The orcs will kill us all!
		[/message]
	[/event]

	[event]
	name=enemies defeated
		[message]
		description=Dacyn
		id=msg_cmpg_ei_15_19
		message="Well, we didn't have to blow up the bridge after all, but we still have to go south."
		[/message]
		[message]
		description=Engineer
		id=msg_cmpg_ei_15_20
		message="What? Y'got no need a me se'vices? I quit!"
		[/message]
		[kill]
		description=Engineer
		[/kill]
	[/event]
[/scenario]
