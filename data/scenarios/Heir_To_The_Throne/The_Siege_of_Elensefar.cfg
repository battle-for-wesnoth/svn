[scenario]
	id=The_Siege_of_Elensefar
	textdomain=wesnoth-httt
	name= _ "The Siege of Elensefar"
	map_data="{maps/Heir_To_The_Throne/The_Siege_of_Elensefar}"
	turns=28

    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}

	next_scenario=Crossroads

	music="wesnoth-2.ogg"

	objectives= _ "
Victory:
@Defeat both enemy leaders
Defeat:
#Death of Konrad
#Turns run out"

	[label]
	x,y=16,28
	text="Elensefar"
	[/label]

	{BIGMAP_SIEGE_OF_ELENSEFAR}

	[side]
	type=Commander
	description=Konrad
	unrenamable=1
	side=1
	canrecruit=1
	controller=human
	recruit=Elvish Scout,Elvish Fighter,Elvish Archer,Horseman,Mage,Elvish Shaman,Merman
	team_name=elves
	[/side]

	[side]
	type=Orcish Warlord
	description=Agadla
	side=2
	canrecruit=1
	recruit=Orcish Warrior,Orcish Assassin,Orcish Crossbowman

	{GOLD 100 200 300}
	team_name=orcs

		[ai]
		recruitment_pattern=fighter,fighter,archer
		leader_value=10.0
		aggression=0.0
		caution=1.0
		grouping=defensive
		[/ai]

		[ai]
		time_of_day=dusk
		aggression=0.6
		grouping=defensive
		[/ai]
		[ai]
		time_of_day=first_watch,second_watch
		aggression=0.7
		caution=0.25
		grouping=offensive
		[/ai]
	[/side]

	[side]
	type=Necromancer
	description=Muff Jaanal
	side=3
	canrecruit=1

	recruit=Skeleton Archer,Skeleton

	{GOLD 120 200 300}

	team_name=orcs

		[ai]
		recruitment_pattern=fighter,fighter,archer
		leader_value=10.0
		[/ai]

		[ai]
		time_of_day=dusk,first_watch,second_watch
		aggression=1.0
		grouping=no
		[/ai]
	[/side]

	[time_area] 
		x=13-22
		y=1-4
		{UNDERGROUND}
	[/time_area] 

	[event]
	name=prestart
	
	#start the orcs/undead with most of the villages on the map
	{STARTING_VILLAGES 2 10}
	{STARTING_VILLAGES 3 20}

	[role]
		type=Elvish Champion,Elvish Marshal,Elvish Captain,Elvish Hero,Knight,Elvish Outrider,Elvish Rider,Paladin,Mage,White Mage,Red Mage
		role=Advisor
	[/role]
	[recall]
		role=Advisor
	[/recall]

	[/event]

	[event]
	name=start
		[message]
		speaker=narrator
		message= _ "The party arrived at Elensefar at last, but found that the city had already fallen to the evil Orcs."
		[/message]
		[message]
		role=Advisor
		message= _ "My lord! It seems the city has already fallen!"
		[/message]
		[message]
		description=Konrad
		message= _ "This is terrible news! We must retake the city!"
		[/message]
		[message]
		role=Advisor
		message= _ "There are so many of them. This will not be easy! And look to the south! It seems that the undead are allied with the Orcs!"
		[/message]
		[message]
		description=Muff Jaanal
		message= _ "Here come the Elves! With our newly forged alliance with the Orcs, we will crush them with ease!"
		[/message]
		[message]
		role=Konrad
		message= _ "We must take the city, and destroy the evil undead before reinforcements arrive!"
		[/message]
	[/event]

	[event]
	name=turn 5
		[move_unit_fake]
			type=Thief
			x=24,24,23
			y=38,39,40
		[/move_unit_fake]
		[unit]
		description=Reglok
		type=Thief
		side=1
		x=23
		y=40
		[/unit]
		[unit]
		description=Gelgar
		type=Thief
		side=1
		x=22
		y=39
		[/unit]
		[unit]
		description=Gamlel
		type=Thief
		side=1
		x=24
		y=40
		[/unit]

		[redraw]
		[/redraw]

		[message]
		speaker=narrator
		message= _ "In the night, three dark figures creep out of the forest."
		[/message]
		[message]
		description=Konrad
		message= _ "Halt! Who goes there, friend or foe?"
		[/message]
		[message]
		description=Reglok
		message= _ "Greetings, friend. We are from the Elensefar Thieves Guild. We would like to help you against the Orcs!"
		[/message]
		[message]
		role=Advisor
		message= _ "Thieves, hmmm? Who says we can trust such as you?"
		[/message]
		[message]
		description=Gamlel
		message= _ "We would understand if you don't trust us, of course, but it is in our mutual interest to rid the city of the Orcs!"
		[/message]
		[message]
		description=Konrad
		message= _ "Hmm...I have to consider this..."
			[option]
			message= _ "Very well. You may join us."
				[command]
					[message]
					description=Gamlel
					message= _ "We will serve you well, for we respect the help you are providing to our city. You shall find that there is honor, even among thieves."
					[/message]
					[set_variable]
					name=have_thieves
					value=yes
					[/set_variable]
					[allow_recruit]
					type=Thief
					[/allow_recruit]
				[/command]
			[/option]
			[option]
			message= _ "We cannot trust your motives. We shall rescue the city on our own!"
				[command]
					[message]
					description=Gamlel
					message= _ "Very well, we shall be gone then. You shall have to recapture the city without our help!"
					[/message]
					[kill]
					type=Thief
					[/kill]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
	name=victory
		[message]
		description=Konrad
		message= _ "Finally, we have retaken the city! Let us rest here, friends."
		[/message]
		[role]
		role=Thief
		type=Assassin,Rogue,Thief
		[/role]
		[message]
		role=Thief
		message= _ "Victory! The thieves of Elensefar will be in your service, my lord"
		[/message]
		[message]
		speaker=narrator
		message= _ "The party rested for three days, after which an old friend returned."
		[/message]

		[move_unit_fake]
			type=Elder Mage
			x=25,24,24
			y=18,17,16
		[/move_unit_fake]

		[unit]
		description=Delfador
		unrenamable=1
		type=Elder Mage
		x=24
		y=16
		side=1
		[/unit]
		[unit]
		description=Kalenz
		unrenamable=1
		type=Elvish Lord
		x=22
		y=16
		side=1
		[/unit]

		[redraw]
		[/redraw]

		[message]
		description=Delfador
		message= _ "Greetings, friends. I see that you have rescued the city! I knew that you could do it."
		[/message]

		[message]
		description=Konrad
		message= _ "Delfador! So good to see you! Where have you been?"
		[/message]

		[message]
		description=Delfador
		message= _ "I have been meeting with the Great Elven Council. This is Kalenz, a lord of the Northern Elves who came to the Council to offer us the support of the North Elves."
		[/message]

		[message]
		description=Kalenz
		message= _ "Greetings, friend."
		[/message]

		[message]
		description=Konrad
		message= _ "Delfador, we have captured this city, but surely Asheviere's men will come and attack us! What should we do?"
		[/message]

		[message]
		description=Delfador
		message= _ "The Council has met and decided: we must capture the Scepter of Fire."
		[/message]

		[message]
		description=Konrad
		message= _ "The Scepter of Fire? What's that?"
		[/message]

		[message]
		description=Delfador
		message= _ "During the reign of Garard I, your grandfather, the dwarves of Knalga agreed to make the king a magnificent scepter. It took their finest smiths years to make it. But soon after it was completed, Orcs invaded the tunnels of Knalga. Now Knalga is in chaos, and, though some Dwarves still live in parts of it, at constant war with the Orcs, the Scepter was lost somewhere in the great caverns."
		[/message]

		[message]
		description=Konrad
		message= _ "But what has this to do with me?"
		[/message]

		[message]
		description=Delfador
		message= _ "When Garard II, your uncle, was deciding upon a successor, he issued an edict that whichever member of the royal family could retrieve the Scepter of Fire would rule the land."
		[/message]

		[message]
		description=Konrad
		message= _ "Oh, and you want me to get this scepter?"
		[/message]

		[message]
		description=Kalenz
		message= _ "We will help you get it, my lord."
		[/message]

		[message]
		description=Delfador
		message= _ "Time is short. We think that Asheviere is also searching for the Scepter, to help seal her place as ruler. But if you get the Scepter first, the people will support you as the king."
		[/message]

		[message]
		description=Konrad
		message= _ "Me? King?"
		[/message]

		[message]
		description=Delfador
		message= _ "Yes, Konrad. I believe you will be king one day. Now let us make haste!"
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=16-17
			y=4-5
		[/filter]

		[message]
		description=Muff Jaanal
		message= _ "So you endeavour to fight me in my home. Foolish."
		[/message]

#ifdef EASY
		[gold]
			side=3
			amount=30
		[/gold]
#else
		[gold]
			side=3
			amount=60
		[/gold]
#endif

		[terrain]
			x=13
			y=2
			letter=u
		[/terrain]
		[sound]
			name=gunshot.wav
		[/sound]
#ifdef HARD
		[unit]
			type=Revenant
			side=3
			x=13
			y=2
		[/unit]
#else
		[unit]
			type=Skeleton
			side=3
			x=13
			y=2
		[/unit]
#endif
		[scroll_to_unit]
			x=13
			y=2
		[/scroll_to_unit]

		[terrain]
			x=22
			y=1
			letter=u
		[/terrain]
		[sound]
			name=gunshot.wav
		[/sound]
#ifdef HARD
		[unit]
			type=Revenant
			side=3
			x=22
			y=1
		[/unit]
#else
		[unit]
			type=Skeleton
			side=3
			x=22
			y=1
		[/unit]
#endif
		[scroll_to_unit]
			x=22
			y=1
		[/scroll_to_unit]
	[/event]

	{scenarios/Heir_To_The_Throne/deaths.cfg}
[/scenario]

