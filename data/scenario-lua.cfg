#textdomain wesnoth
[test]
    name="Test scenario"
    turns=-1
    id=lua_wml
    map_data="{multiplayer/maps/4p_Lagoon.map}"
    victory_when_enemies_defeated=no
    
    [side]
        side=1
        controller=human
        type=Elvish Archer
        canrecruit=yes
    [/side]

    [event]
        name=prestart

        [wml_action]
            name=wml_subtag

            [attribute]
                name=name
            [/attribute]
            [attribute]
                name=lua_function
            [/attribute]

            lua_function= << return function(cfg) return end >>
        [/wml_action]

        [wml_subtag]
            name=location
            wiki=""
            lua_function= << return function(cfg) return end >>
        [/wml_subtag]

        [wml_subtag]
            name=standard_location_filter
            wiki=""
            [location]
            [/location]
            [attribute]
                name=id
            [/attribute]
            [attribute]
                name=typ
            [/attribute]
        [/wml_subtag]

        [wml_subtag]
            name=standard_unit_filter
            wiki=""
            [location]
            [/location]
            [attribute]
                name=id
            [/attribute]
            [attribute]
                name=typ
            [/attribute]
        [/wml_subtag]

        [wml_subtag]
            name=option
        [/wml_subtag]

        [wml_subtag]
            name=actions
            lua_function= << return function(cfg) end >>
        [/wml_subtag]

#### Conditional Actions ####

        [wml_action]
            name=if
            wiki="Blah blah"
            
            [conditions]
                mode=and
            [/conditions]

            [subtag]
                name=then
                optional=no
            [/subtag]
            [subtag]
                name=else
            [/subtag]
            lua_function= << return function(cfg) if conditions(cfg) then            return end >>
        [/wml_action]

        [wml_subtag]
            name=then
            wiki=""
            [actions]
            [/actions]
        [/wml_subtag]

        [wml_subtag]
            name=else
            wiki=""
            [actions]
            [/actions]
        [/wml_subtag]

        [wml_action]
            name=switch
            wiki= << The [switch] tag is a special case because it does not use Condition Tags to control whether actions are performed. Instead, it executes different sets of actions based on the value of a variable. >>
            [attribute]
                name=variable
                wiki="The name of the variable to check."
            [/attribute]
            [subtag]
                name=case
            [/subtag]
            [subtag]
                name=else
            [/subtag]
        [/wml_action]

        [wml_subtag]
            name=case
            [attribute]
                name=value
            [/attribute]
            [action_wml]
            [/action_wml]
        [/wml_subtag]

        [wml_action]
            name=while
            [conditions]
                mode=and
            [/conditions]
            [subtag]
                name=do
            [/subtag]
        [/wml_action]


        [wml_subtag]
            name=conditions
                [subtag]
                    name=have_unit
                [/subtag]
                [subtag]
                    name=have_location
                [/subtag]
                [subtag]
                    name=variable
                [/subtag]
                #Meta Condition Tags
                [subtag]
                    name=and
                [/subtag]
                [subtag]
                    name=or
                [/subtag]
                [subtag]
                    name=not
                [/subtag]
        [/wml_subtag]

        [wml_action]
            name="message"            
            [standart_unit_filter]
            [/standart_unit_filter]

            [attribute]
                name=message
                type=string
                wiki="(translatable) the text to display to the right of the image. message is sometimes multiple lines; if it is, be sure to use quotes" 
            [/attribute]
            [attribute]
                name=speaker
                type=enum
                enum=narrator,unit,second_unit
                wiki=""
            [/attribute]

            lua_function= << return function(cfg) wesnoth.fire("message", { speaker=cfg.speaker, message=cfg.message }) end >>
        [/wml_action]

#### Condition Tags ####
        [wml_subtag]
            name=have_unit
            wiki="A unit with greater than zero hit points matching this filter exists."
            [attribute]
                name=count
                wiki= <<If used, a number of units equal to the value must match the filter. Accepts a number, range, or comma separated range. If not used, the default value is "1-99999".>>
                optional=yes
            [/attribute]
        [/wml_subtag]

        [wml_subtag]
            name=have_location
            [attribute]
                name=count
                wiki= <<If used, a number of locations equal to the value must match the filter. Accepts a number, range, or comma separated range. If not used, the default value is "1-99999".>>
                optional=yes
            [/attribute]
        [/wml_subtag]

        [wml_subtag]
            name=variable
            wiki=""

            [attribute]
                name=name
                type=string
            [/attribute]

            [option]
                [attribute]
                    name=contains
                [/attribute]
                [attribute]
                    name=equals
                [/attribute]
                [attribute]
                    name=not_equals
                [/attribute]
                [attribute]
                    name=numerical_equals
                [/attribute]
                [attribute]
                    name=numerical_not_equals
                [/attribute]
                [attribute]
                    name=greater_than
                [/attribute]
                [attribute]
                    name=greater_than_equal_to
                [/attribute]
                [attribute]
                    name=less_than
                [/attribute]
                [attribute]
                    name=less_than_equal_to
                [/attribute]
                [attribute]
                    name=boolean_equals
                    type=boolean
                [/attribute]
                [attribute]
                    name=boolean_not_equals
                    type=boolean
                [/attribute]
            [/option]

            lua_function= << return function(cfg) return end >>
        [/wml_subtag]



#### /Condition Tags ####


    [/event]

    [event]
        name=turn 3
        [if]
            [variable]
                boolean_equals=true
                name=conditional_test
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    message="Yes, it's true!"
                [/message]                
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message="No, it's false!"
                [/message]                
            [/else]
        [/if]
    [/event]

[/test]

# vim: tabstop=4: shiftwidth=4: expandtab: softtabstop=4: autoindent:
# kate: indent-mode normal; space-indent on;
