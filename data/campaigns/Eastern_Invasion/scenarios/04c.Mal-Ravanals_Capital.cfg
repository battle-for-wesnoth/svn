#textdomain wesnoth-ei
[scenario]
    id=Mal-Ravanals_Capital
    name= _ "Mal-Ravanal's Capital"
    map_data="{campaigns/Eastern_Invasion/maps/Mal-Ravanals_Capital.map}"
    turns=36

    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {DUSK}
    {FIRST_WATCH}
    {FIRST_WATCH}
    {SECOND_WATCH}
    {SECOND_WATCH}

    next_scenario=Northern_Outpost

    {INTRO_AND_SCENARIO_MUSIC underground.ogg the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}

    {campaigns/Eastern_Invasion/utils/deaths.cfg}

    [story]
        [part]
            show_title=yes
            {TO_MAL_RAVANALS_CAPITOL}
        [/part]
    [/story]

    [side]
        type=Lieutenant
        id=Gweddry
        name= _ "Gweddry"
        side=1
        canrecruit=yes
        controller=human
    [/side]

    [side]
        type=Dark Sorcerer
        id=Mal-Marak
        name= _ "Mal-Marak"
        side=2
        canrecruit=yes
        recruit=Walking Corpse,Skeleton,Skeleton Archer
        {GOLD 100 150 200}
        team_name=undead
        user_team_name=_"Undead"
    [/side]

    [side]
        type=Dark Sorcerer
        id=Mal-Galkar
        name= _ "Mal-Galkar"
        recruit=Vampire Bat,Skeleton,Skeleton Archer
        side=3
        canrecruit=yes
        {GOLD 100 150 200}
        team_name=undead
        user_team_name=_"Undead"
    [/side]

    [side]
        type=Death Knight
        id=Ravanal-Guard
        name= _ "Rava-Krodaz"
        recruit=Revenant,Bone Shooter
        side=4
        canrecruit=yes
        {GOLD 300 400 600}
        team_name=undead
        user_team_name=_"Undead"
        [ai]
            aggression=-0.2
        [/ai]
    [/side]

    [side]
        type=Lich
        id=Mal-Ravanal
        name= _ "Mal-Ravanal"
        recruit=Dark Adept,Bone Shooter,Revenant,Wraith,Shadow
        side=5
        canrecruit=yes
        profile=portraits/mal-ravanal.png
        {GOLD 500 600 700}
        team_name=undead
        user_team_name=_"Undead"
        [ai]
            passive_leader=yes
        [/ai]
    [/side]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Escape from the capital by killing one of the two dark sorcerers"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Gweddry"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dacyn"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=start
        [recall]
            id=Dacyn
        [/recall]
        [message]
            speaker=Gweddry
            message= _ "The Bitter Swamp's ill reputation is, it seems, well merited. Mal-Ravanal's capital lies before us!"
        [/message]

        [message]
            speaker=Dacyn
            message= _ "Yes, but look! The undead forces are closing in behind us. As I said before, we cannot kill Mal-Ravanal. It was foolish to come this far, we must turn back!"
        [/message]

        [message]
            speaker=Gweddry
            message= _ "Perhaps. To retreat, we must kill one of these dark sorcerers that follow us. But, perhaps we can kill this Mal-Ravanal still. I might wish to try."
        [/message]

        [message]
            speaker=Mal-Ravanal
            profile=portraits/mal-ravanal.png
            message= _ "These humans have dared foolishly to come this far into my land. Crush them!"
        [/message]
        #there are 6 prisoner knights you can rescue
        [set_variable]
            name=prisoners_left
            value=6
        [/set_variable]
    [/event]

    [event]
        name=die
        [filter]
            side=4
        [/filter]
        [unit]
            type=Paladin
            side=1
            id=Terraent
            name= _ "Terraent"
            x=25
            y=17
        [/unit]
        [message]
            speaker=Terraent
            message= _ "Thank you for destroying that skeleton warrior! Every time you kill one of the Revenants, one of us knights is let free!"
        [/message]
        [message]
            speaker=Gweddry
            message= _ "Why? Are you the undead's prisoners?"
        [/message]
        [message]
            speaker=Terraent
            message= _ "Yes. My allies and I were questing when we were ambushed by undead. The guard is playing a sick game - whenever one of their warriors dies, one of us is let free, but whenever you lose a fighter, they kill one of us."
        [/message]
        [message]
            speaker=Dacyn
            message= _ "This sounds dangerous. We will try to free as many of you as possible before we escape from here."
        [/message]
        [message]
            speaker=Terraent
            message= _ "There are five of us still locked up in the jail. All of us will join you if you can get us free."
        [/message]
        [event]
            name=die
            first_time_only=no
            [filter]
                side=4
            [/filter]
            [if]
                [variable]
                    name=prisoners_left
                    greater_than=0
                [/variable]
                [then]
                    [unit]
                        type=Knight
                        side=1
                        x=25
                        y=17
                    [/unit]
                    [set_variable]
                        name=prisoners_left
                        add=-1
                    [/set_variable]
                [/then]
            [/if]
        [/event]
        [event]
            name=die
            first_time_only=no
            [filter]
                side=1
            [/filter]
            [if]
                [variable]
                    name=prisoners_left
                    greater_than=0
                [/variable]
                [then]
                    [set_variable]
                        name=prisoners_left
                        add=-1
                    [/set_variable]
                [/then]
            [/if]
        [/event]
    [/event]

    #impossible to kill Mal-Ravanal
    [event]
        name=attack
        first_time_only=no
        [filter_second]
            id=Mal-Ravanal
        [/filter_second]
        [message]
            speaker=Mal-Ravanal
            profile=portraits/mal-ravanal.png
            message= _ "You dare to attack ME?!? Go back to your master!"
        [/message]
        [message]
            speaker=Gweddry
            message= _ "This is not good; we are unable to attack Mal-Ravanal at all, for his magic is too strong! We must turn back, it was foolish to press the attack."
        [/message]
        [teleport]
            [filter]
                x,y=$x1,$y1
                side=1
            [/filter]
            x=19
            y=13
        [/teleport]
    [/event]

    #when you kill one of the necros you win
    [event]
        name=die
        [filter]
            id=Mal-Marak
        [/filter]
        [endlevel]
            result=victory
            bonus=yes
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=Mal-Galkar
        [/filter]
        [endlevel]
            result=victory
            bonus=yes
        [/endlevel]
    [/event]

    [event]
        name=victory
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_ "Gweddry's men retreated swiftly from the Bitter Swamp, fleeing north and west as if their heels were winged. Finding a low pass through the northern Estmarks, they were greatly relieved to see the valley of the Weldyn open before them on the other side."
        [/message]
    [/event]
[/scenario]
