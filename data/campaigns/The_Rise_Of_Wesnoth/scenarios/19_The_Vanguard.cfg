#textdomain wesnoth-trow
[scenario]
    id=The_Vanguard
    name= _ "The Vanguard"
    next_scenario=Return_of_the_Fleet
    bonus=yes
    map_data="{campaigns/The_Rise_Of_Wesnoth/maps/The_Vanguard.map}"

    {TURNS 41 38 35}
    {DEFAULT_SCHEDULE}

    {SCENARIO_MUSIC loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC northerners.ogg}
    {EXTRA_SCENARIO_MUSIC breaking_the_chains.ogg}
    {EXTRA_SCENARIO_MUSIC siege_of_laurelmor.ogg}

    # No story
    {THE_VANGUARD_BIGMAP}

    {TROW_DEATHS}

    [side]
        id=Prince Haldric
        name= _ "Prince Haldric"
        side=1
        type=Noble Commander
        unrenamable=yes
        canrecruit=yes
        gold=200
        controller=human
        team_name=Haldric
        user_team_name=_"Refugees"
        fog=yes
        {FLAG_VARIANT loyalist}
    [/side]

    [side]
        type=Orcish Warlord
        id=Tan-Erirt
        name= _ "Tan-Erirt"
        side=2
        canrecruit=yes
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif

#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Orcish Slayer, Orcish Warrior, Goblin Spearman
#endif

#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Goblin Impaler
#endif
        {GOLD 150 190 230}
        team_name=orcs
        user_team_name=_"Orcs"
        [ai]
            #{NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
            recruitment_pattern=scout,fighter,fighter,mixed fighter,archer
            {ATTACK_DEPTH 5 5 6}
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
        [/ai]
        {INCOME 2 4 8}
    [/side]

    {STARTING_VILLAGES 2 8}

    [side]
        type=Orcish Warlord
        id=Tan-Gagar
        name= _ "Tan-Gagar"
        side=3
        canrecruit=yes
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif

#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Orcish Slayer, Orcish Warrior, Goblin Spearman
#endif

#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Goblin Impaler
#endif
        {GOLD 150 190 230}
        team_name=orcs
        user_team_name=_"Orcs"
        [ai]
            #{NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
            recruitment_pattern=scout,fighter,fighter,mixed fighter,archer
            {ATTACK_DEPTH 5 5 6}
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
        [/ai]
        {INCOME 2 4 8}
    [/side]

    {STARTING_VILLAGES 3 8}

    [side]
        type=Troll Warrior
        id=Thruf
        name= _ "Thruf"
        side=4
        canrecruit=yes
#ifdef EASY
        recruit=Troll Whelp
#endif

#ifdef NORMAL
        recruit=Troll Whelp,Troll,Troll Rocklobber
#endif

#ifdef HARD
        recruit=Troll Whelp,Troll,Troll Warrior,Troll Rocklobber
#endif

        {GOLD 110 150 190}
        team_name=orcs
        user_team_name=_"Orcs"
        [ai]
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
#ifdef EASY
            recruitment_pattern=fighter
#else
            recruitment_pattern=fighter,fighter,mixed fighter
#endif
            grouping=no
            {ATTACK_DEPTH 5 5 6}
        [/ai]

        {INCOME 2 4 8}
    [/side]

    {STARTING_VILLAGES 4 8}

    {ANIMATED_CAMPFIRE 4 24}
    {ANIMATED_CAMPFIRE 8 25}
    {ANIMATED_CAMPFIRE 26 9}
    {ANIMATED_CAMPFIRE 25 17}

    [event]
        name=prestart

        {VARIABLE_OP xx1 random 10..18}
        {VARIABLE_OP yy1 random 2..6}

        {PLACE_IMAGE (items/chest-plain-closed.png) $xx1 $yy1}

        [recall]
            id=Lady Jessene
        [/recall]
        [recall]
            id=Commander Aethyr
        [/recall]

        #OK Get rid of the Ruby of Fire
        [store_unit]
            [filter]
                id=Prince Haldric
            [/filter]

            kill=yes
            variable=stored_Haldric
        [/store_unit]

        {FOREACH stored_Haldric.modifications.object i}
            [if]
                [variable]
                    name=stored_Haldric.modifications.object[$i].id
                    equals=ruby_of_fire
                [/variable]

                [then]
                    {CLEAR_VARIABLE stored_Haldric.modifications.object[$i]}
                [/then]
            [/if]
        {NEXT i}

        {FOREACH stored_Haldric.attack i}
            [if]
                [variable]
                    name=stored_Haldric.attack[$i].name
                    equals=ruby of fire
                [/variable]

                [then]
                    {CLEAR_VARIABLE stored_Haldric.attack[$i]}
                [/then]
            [/if]
        {NEXT i}

        [unstore_unit]
            variable=stored_Haldric
        [/unstore_unit]

        {CLEAR_VARIABLE stored_Haldric}

        [objectives]
            side=1
            [objective]
                description= _ "Defeat all enemy leaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Prince Haldric"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Commander Aethyr"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]

            note={EARLY_FINISH_BONUS_NOTE}+{NEW_GOLD_CARRYOVER_NOTE_40}
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            speaker=narrator
            message= _ "Haldric and his companions race across the plains to confront the resurgent orcish threat. On the eve of battle, Lady Jessene catches up with Haldric on a fog-covered plain."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker=Lady Jessene
            message= _ "Haldric, the elves, we can't trust them!"
        [/message]

        [message]
            speaker=Prince Haldric
            message= _ "I could have told you that."
        [/message]
        [message]
            speaker=Lady Jessene
            message= _ "Haldric, it's bad. The elves are having second thoughts. They think we might be more trouble than we're worth. We have to defeat these orcs decisively."
        [/message]
        [message]
            speaker=Prince Haldric
            message= _ "That does not sound unreasonable."
        [/message]
        [message]
            speaker=Lady Jessene
            message= _ "More orcs will follow after these. That ruby guarantees it. If more orcs follow us here, the elves seem content to let us fight it out. Then they said they would 'deal with the survivors'."
        [/message]
        [message]
            speaker=Lady Jessene
            message= _ "Jevyan is here... His familiar, that bat. He won't let such a lucrative prize as the Ruby of Fire just slip away. Especially when he sees that he has the advantage."
        [/message]
        [message]
            speaker=Prince Haldric
            message= _ "I have a plan. Jessene, remember that troll-hole? Here, take the Ruby of Fire, hide it in the hole."
        [/message]
        [message]
            speaker=Lady Jessene
            message= _ "Haldric! What! Why?"
        [/message]
        [message]
            speaker=Prince Haldric
            message= _ "Just do it."
        [/message]
        [message]
            speaker=Prince Haldric
            message= _ "Commander Aethyr, did these orcs come on our ships? Did they capture the fleet we sent out?"
        [/message]
        [message]
            speaker=Commander Aethyr
            message= _ "No, sir! They must have seized all remaining boats on the Green Isle. Our fleet should be returning any day now."
        [/message]
        [message]
            speaker=Prince Haldric
            message= _ "We are a refugee people. We must push back their vanguard, and secure our beachhead. If they capture our ships all is lost. We will be crushed under a tide of orcs."
            image=portraits/haldric-mad.png
        [/message]

        [recall]
            id=Burin the Lost
        [/recall]
        [recall]
            id=Sir Ruddry
        [/recall]
        [recall]
            id=Sir Ladoc
        [/recall]
        [recall]
            id=Minister Edmond
        [/recall]

        [store_unit]
            variable=jessica_store
            kill=yes
            [filter]
                id=Lady Jessene
            [/filter]
        [/store_unit]

        [message]
            speaker=narrator
            message= _ "Lady Jessene soon departs. In the distance a voice booms:"
            image=wesnoth-icon.png
        [/message]

        [message]
            speaker=Tan-Gagar
            message= _ "Drop the gold where it is! We've paid our friends enough. There are humans about, I can smell 'em!"
        [/message]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Prince Haldric
            message= _ "We have run out of time... We'll never beat the orcs to the beach."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=$xx1
            y=$yy1
        [/filter]

        [sound]
            name=open-chest.wav
        [/sound]

        [message]
            speaker=unit
            message= _ "I've found the orcs' chest! It's filled with gold."
        [/message]

        [removeitem]
        [/removeitem]

        {PLACE_IMAGE (items/chest-plain-open.png) $xx1 $yy1}

#ifdef EASY
        {LOOT 125 1}
#endif

#ifdef NORMAL
        {LOOT 100 1}
#endif

#ifdef HARD
        {LOOT 75 1}
#endif
    [/event]

    [event]
        name=attack
        [filter_second]
            id=Tan-Erirt
        [/filter_second]

        {UNDEAD_INTEL (Banebow) (Rabbin) ( _ "Rabbin") "unit_image" 2 1 28}
        # wmllint: recognize Rabbin

        [message]
            speaker=Rabbin
            message= _ "You will be felled by my hand, useless fleshbags!"
        [/message]

        {LOYAL_UNDEAD_UNIT 2 (Chocobone) 1 29}
        {LOYAL_UNDEAD_UNIT 2 (Chocobone) 1 27}
#ifdef HARD
        {LOYAL_UNDEAD_UNIT 2 (Chocobone) 2 28}
#endif
    [/event]

    [event]
        name=attack
        [filter_second]
            #The Forest Orc
            id=Tan-Gagar
        [/filter_second]

        {UNDEAD_INTEL (Draug) (General Kafka) ( _ "General Kafka") "unit_image" 3 35 19}
        # wmllint: recognize General Kafka

        [message]
            speaker=General Kafka
            message= _ "Never trust the living to do the job of the undead. Prepare to meet the inevitable!"
        [/message]

        [message]
            speaker=Minister Edmond
            message= _ "The only job of the dead is to remain dead. Prepare to be reunited with the ground."
        [/message]

        {LOYAL_UNDEAD_UNIT 3  (Chocobone) 35 18}
        {LOYAL_UNDEAD_UNIT 3  (Chocobone) 35 20}
#ifdef HARD
        {LOYAL_UNDEAD_UNIT 3  (Chocobone) 35 17}
        {LOYAL_UNDEAD_UNIT 3  (Chocobone) 35 21}
#endif
    [/event]

    [event]
        name=die
        [filter]
            id=Tan-Erirt
        [/filter]

        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tan-Gagar
            message= _ "We must block the human advance!"
        [/message]

        [gold]
            side=3
            amount=80
        [/gold]
    [/event]

    [event]
        name=die
        [filter]
            id=Tan-Gagar
        [/filter]

        [filter_second]
            side=1
        [/filter_second]

        [message]
            speaker=Tan-Erirt
            message= _ "Reserves! We can't let them get to their landing site."
        [/message]

        [gold]
            side=2
            amount=80
        [/gold]
    [/event]

    [event]
        name=enemies defeated

        [message]
            speaker=Prince Haldric
            message= _ "We've defeated their vanguard. We have to meet the fleet before Jevyan destroys them and captures the ships. I hope Jessene makes it back soon."
        [/message]

        {CLEAR_VARIABLE xx1}
        {CLEAR_VARIABLE yy1}

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=Commander Aethyr
        [/filter]

        [message]
            speaker=Commander Aethyr
            message= _ "Oh, to join my family again! Do not mourn my passing."
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=attack
        [filter]
            id=Burin the Lost
        [/filter]

        [message]
            speaker=Burin the Lost
            message= _ "Ahh, it's great to be home! I'm not much for the politics, but it's great to be home!"
        [/message]
    [/event]
[/scenario]
