#textdomain wesnoth-low
[scenario]
    id=14_Human_Alliance
    name= _ "Human Alliance"

    {LOW_MAP 14_Human_Alliance.map}
    #shortens the map on the left border for the later reenforcements
    [event]
        name=prestart
        [terrain]
            terrain=Xv
            x=0-6
            y=0-53
        [/terrain]
    [/event]

    #out of turns leads to victory
    {TURNS 16 20 25}
    victory_when_enemies_defeated=no

    #TODO at what time does the battle begin?
    {DEFAULT_SCHEDULE}

    {STARTING_VILLAGES_ELF   1}
    {STARTING_VILLAGES_HUMAN 2}
    {STARTING_VILLAGES_TROLL 5}

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC knolls.ogg}
    {EXTRA_SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC breaking_the_chains.ogg}

    next_scenario=15_The_Treaty
    [story]
        [part]
            story= _ "With the human-elf alliance revived, our heroes hurried to the battlefield..."
            delay=4000
            {TO_HUMAN_ALLIANCE}
        [/part]
        [part]
            show_title=yes
            {TO_HUMAN_ALLIANCE_BATTLE}
        [/part]
    [/story]

    #wmllint: validate-off
    [side]
        {KALENZ}
        # wmllint: recognize Kalenz
        recruit={ELVES},{DWARVES}
        {GOLD 250 200 150}
    [/side]
    #wmllint: validate-on
    [event]
        name=prestart
        {RECALL_LOYALS}

        [recall]
            id=Olurf
        [/recall]

        {CHECK_LANDAR}
        {CHECK_CLEODIL}
        {CHECK_OLURF}
    [/event]

    [side]
        type=General
        id=Aldar
        name= _ "Aldar"
        profile="portraits/aldar.png"
        side=2
        controller=ai
        canrecruit=yes
        {GOLD 550 500 450}
        recruit=Heavy Infantryman,Dragoon,Longbowman,Duelist,Halberdier,Horseman,Cavalier,Cavalryman, Royal Guard, Mage, Swordsman, Bowman
        team_name=kalenz
        [ai]
            passive_leader=yes
            [avoid]
                x=1-47
                y=1-14
            [/avoid]
        [/ai]
    [/side]

    [side]
        type=Orcish Warlord
        id=Pirror
        name=_ "Pirror"
        side=3
        canrecruit=yes
#ifdef EASY
        recruit={ORCS1}, Orcish Crossbowman, Goblin Pillager, Goblin Knight
#endif

#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Orcish Slayer, Orcish Warrior, Goblin Spearman
#endif

#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Goblin Impaler, Goblin Rouser, Direwolf Rider
#endif
        {GOLD 320 400 430}
        team_name=orcs
        [ai]
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
            {ATTACK_DEPTH 4 5 6}
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
        [/ai]
        {INCOME 4 8 12}
    [/side]

    [side]
        type=Orcish Warlord
        id=Tan-Grub
        name=_ "Tan-Grub"
        profile="portraits/orcs/warlord.png"
        side=4
        canrecruit=yes
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif
#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman, Orcish Slayer, Orcish Warrior 
#endif
#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman, Orcish Slayer, Orcish Warrior, Goblin Impaler
#endif
        {GOLD 220 300 360}
        team_name=orcs
        [ai]
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
            {ATTACK_DEPTH 4 5 6}
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
        [/ai]
        {INCOME 4 8 12}
    [/side]

    [side]
        type=Great Troll
        id=Grol
        name=_ "Grol"
        side=5
        canrecruit=yes
        #TODO think about adding troll shamans
#ifdef EASY
        recruit=Troll Whelp,Troll
#endif
#ifdef NORMAL
        recruit=Troll Whelp,Troll,Troll Rocklobber
#endif
#ifdef HARD
        recruit=Troll Whelp,Troll,Troll Warrior,Troll Rocklobber
#endif
        {GOLD 220 260 300}
        team_name=orcs
        [ai]
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
#ifdef EASY
            recruitment_pattern=fighter
#else
            recruitment_pattern=fighter,fighter,mixed fighter
#endif
            grouping=no
            {ATTACK_DEPTH 4 5 6}
        [/ai]

        {INCOME 4 8 12}
    [/side]

    [side]
        type=Orcish Warlord
        id=Khafa-Urg
        name=_ "Khafa-Urg"
        side=6
        canrecruit=yes
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif
#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman, Orcish Slayer, Orcish Warrior
#endif
#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman, Orcish Slayer, Orcish Warrior, Goblin Impaler
#endif
        {GOLD 320 400 450}
        team_name=orcs
        [ai]
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
            {ATTACK_DEPTH 4 5 6}
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
        [/ai]
        {INCOME 4 8 12}
    [/side]

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                description= _ "Last for the end of turns"
                condition=win
            [/objective]
            note={NO_EARLY_FINISH_BONUS_NOTE}
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Olurf"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Aldar"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            id=Kalenz
            message= _ "Here we are! Prepare to fight!"
        [/message]
        [message]
            id=Aldar
            message= _ "So it is true! The elves have come to our help!"
        [/message]

        [unit]
            id=Aldun
            name=_ "Aldun"
            type=Horseman
            side=1
            x=24
            y=23
            facing=sw
        [/unit]
        {MOVE_UNIT id=Aldun 24 21}

        [message]
            id=Aldun
            message= _ "General Aldar has received your message that you will be coming. He asks that you cut off the orcish reinforcements from the north. They must not be allowed to enter the battle! Our reinforcements should arrive in a few days."
        [/message]
        [message]
            id=Kalenz
            message= _ "Very well, but where are the elvish troops? We cannot hold without them!"
        [/message]
    [/event]


    #### reenforcements for the orcs ####

#define ORCS
#ifdef EASY
    recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif
#ifdef NORMAL
    recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman, Orcish Slayer, Orcish Warrior, 
#endif
#ifdef HARD
    recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman, Orcish Slayer, Orcish Warrior, Goblin Impaler
#endif
#enddef

    [side]
        side=7
        no_leader=yes
        {GOLD 320 400 450}
        team_name=orcs
        {ORCS}
    [/side]

    [side]
        side=8
        no_leader=yes
        {GOLD 320 400 450}
        team_name=orcs
        {ORCS}
    [/side]

    [side]
        side=9
        no_leader=yes 
        {GOLD 320 400 450}
        team_name=orcs       
        {ORCS}
    [/side]

    [event]
        name=turn 2

        [event]
            name=ai turn

            [unit]
                role=reenforce1
                type=Orcish Warlord
                generate_name=yes
                random_traits=yes
                #            profile="portraits/orcs/warlord.png"
                side=7
                x=5
                y=5
                canrecruit=yes
            [/unit]

            [unit]
                role=reenforce2
                type=Orcish Warlord
                generate_name=yes
                random_traits=yes
                #            profile="portraits/orcs/warlord.png"
                side=8
                x=5
                y=28
                canrecruit=yes
            [/unit]

            [unit]
                role=reenforce3
                type=Orcish Warlord
                generate_name=yes
                random_traits=yes
                #            profile="portraits/orcs/warlord.png"
                side=9
                x=5
                y=32
                canrecruit=yes
            [/unit]

            [message]
                speaker=narrator
#                message="The Rouser blows the attacking signal."
#                sound=ambient/birds1.ogg,ambient/birds2.ogg,ambient/birds3.ogg
                sound=horn/horn-attack.ogg
              #  sounds=ambient/birds1.ogg,ambient/birds2.ogg,ambient/birds3.ogg
              #  sound="campaigns/Legend_of_Wesmere/sounds/horn/horn-attack.ogg"
                image="portraits/rouser_horn.png"
            [/message]

            [replace_map]
                map="{campaigns/Legend_of_Wesmere/maps/14_Human_Alliance.map}"
            [/replace_map]

            [terrain]
                terrain=Xv
                x=0-3
                y=0-53
            [/terrain]

            [redraw]
            [/redraw]

            [message]
                id=Aldar
                message= _ "More of them arrive."
            [/message]

            [message]
                role=reenforce1
                #TODO enhance prose
                message= _ "Har har har!"
            [/message]

            [message]
                role=reenforce2
                #TODO 
                message= _ "me too!"
            [/message]
            

            [scroll_to_unit]
                role=reenforce2
            [/scroll_to_unit]
            
            [scroll_to_unit]
                role=reenforce3
            [/scroll_to_unit]

        [/event]
    [/event]

    [side]
        side=10
        no_leader=yes
        {GOLD 320 400 450}
        team_name=orcs
        {ORCS}
    [/side]

    [side]
        side=11
        no_leader=yes
        {GOLD 320 400 450}
        team_name=orcs
        {ORCS}
    [/side]

    [side]
        side=12
        no_leader=yes 
        {GOLD 320 400 450}
        team_name=orcs       
        {ORCS}
    [/side]

    [event]
        name=turn 3

        [event]
            name=ai turn

            [unit]
                role=reenforce2
                type=Orcish Warlord
                generate_name=yes
                random_traits=yes
                #            profile="portraits/orcs/warlord.png"
                side=10
                x=2
                y=7
                canrecruit=yes
            [/unit]

            [unit]
                role=reenforce2
                type=Orcish Warlord
                generate_name=yes
                random_traits=yes
                #            profile="portraits/orcs/warlord.png"
                side=11
                x=2
                y=39
                canrecruit=yes
            [/unit]

            [unit]
                role=reenforce2
                type=Orcish Warlord
                generate_name=yes
                random_traits=yes
                #            profile="portraits/orcs/warlord.png"
                side=12
                x=1
                y=45
                canrecruit=yes
            [/unit]

            [replace_map]
                map="{campaigns/Legend_of_Wesmere/maps/14_Human_Alliance.map}"
            [/replace_map]

            [redraw]
            [/redraw]

            [message]
                role=reenforce2
                #TODO enhance prose
                message=_ "Har har har!"
            [/message]

        [/event]
    [/event]

    #### /reenforcements for the orcs ####

    #### reenforcements for the player ####

    [event]
        name=turn 6

        {FOREACH l3_store i}
            [unstore_unit]
                find_vacant=yes
                variable=l3_store[$i]
                x=7
                y=15
            [/unstore_unit]
            {NEXT i}
        {CLEAR_VARIABLE l3_store}

        [unit]
            id=Olontoril
            name= _ "Olontoril"
            type=Elvish Hero
            side=1
            x=4
            y=15
            random_traits=yes
        [/unit]
        [unit]
            #id=Artolas
            #name=_ "Artolas"
            type=Elvish Archer
            side=1
            x=1
            y=15
            generate_name=yes
            random_traits=yes
            random_gender=yes
        [/unit]
        [unit]
            type=Elvish Scout
            id=Irglus
            name=_ "Irglus"
            side=1
            x=3
            y=15
            random_traits=yes
        [/unit]
        [unit]
            id=Antomeril
            name=_ "Antomeril"
            type=Elvish Fighter
            side=1
            x=2
            y=15
            random_traits=yes
        [/unit]
        [unit]
            id=Lirdomer
            name=_ "Lirdomer"
            type=Elvish Fighter
            side=1
            x=2
            y=16
            random_traits=yes
        [/unit]
        [unit]
            #id=Eomil
            #name=_ "Eomil"
            type=Elvish Archer
            side=1
            generate_name=yes
            random_gender=yes
            random_traits=yes            
            x=1
            y=16
        [/unit]
        [unit]
            #id=Toltilas
            #name=_ "Toltilas"
            type=Elvish Archer
            side=1
            generate_name=yes
            random_gender=yes
            random_traits=yes            
            x=3
            y=16
        [/unit]
        [message]
            id=Olontoril
            message= _ "Kalenz is here!"
        [/message]
        [message]
            id=Kalenz
            message= _ "Where is the rest of the elvish army? They should be here!"
        [/message]
        [message]
            id=Olontoril
            message= _ "The council has decided it was too risky to send troops here. But we could not let you stand on your own."
        [/message]
    [/event]

    [event]
        name=time over

        [unit]
            type=Paladin
            id=Kulrad
            name=_ "Kulrad"
            side=2
            x=30
            y=30
        [/unit]

        {GENERIC_UNIT 2 Knight 35 33}
        {GENERIC_UNIT 2 Knight 35 36}

        {GENERIC_UNIT 2 Horseman 30 34}
        {GENERIC_UNIT 2 Horseman 34 35}
        {GENERIC_UNIT 2 Horseman 31 34}
        {GENERIC_UNIT 2 Horseman 35 37}
        {GENERIC_UNIT 2 Horseman 33 37}
        {GENERIC_UNIT 2 Horseman 33 39}

        [message]
            id=Kulrad
            message= _ "Here we are, men! Charge!"
        [/message]
        [message]
            #TODO check if the or filter works. 
            id=Tan-Grub
            [or]
                side=3
                canrecruit=yes
            [/or]
            message= _ "More horses!! Run, let's get out of here!"
        [/message]
        [endlevel]
            result=victory
            bonus=no
        [/endlevel]
    [/event]

    [event]
        name=enemies defeated 
        [endlevel]
            result=victory
            bonus=yes
        [/endlevel]
    [/event]

    #wmllint: recognize Cleodil
    [event]
        name=victory
        [message]
            id=Kalenz
            message= _ "We have stopped the orcs once again!"
        [/message]
        [message]
            id=Cleodil
            message= _ "And we have revived the alliance with the humans!"
        [/message]
        [message]
            id=Aldar
            message= _ "The King is here! Hail Haldric II, King of Wesnoth!"
        [/message]
        [kill]
            id=Aldun
        [/kill]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Aldar
        [/filter]
        [message]
            speaker=unit
            message= _ "Tath will fall, we have failed!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Grol
        [/filter]
        [message]
            speaker=unit
            message= _ "I die? Great Chief never said anything about fighting elves and dwarves!"
        [/message]
    [/event]

    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]
