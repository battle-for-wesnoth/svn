#textdomain wesnoth-low
[scenario]
    name= _ "Northern Battle"
    id=22_Northern_Battle
    next_scenario=23_End_of_War

    {LOW_MAP  North_Elves.map}
    {LOW_MASK 22_Northern_Battle.mask}
    {./North_elves_utils.cfg}

    {TURNS 40 36 32}
    {DEFAULT_SCHEDULE}

    # TODO find better music
    {INTRO_AND_SCENARIO_MUSIC elf-land.ogg breaking_the_chains.ogg}
    {EXTRA_SCENARIO_MUSIC legends_of_the_north.ogg}
    {EXTRA_SCENARIO_MUSIC elvish-theme.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}

    [story]
        [part]
            story= _ "Kalenz and Cleodil managed to reach the North Elves to ask for help. Very soon, Landar's army appeared..."
            delay=4000
            {TO_NORTHERN_BATTLE}
        [/part]
    [/story]

    #wmllint: validate-off
    [side]
        {KALENZ}
        # wmllint: recognize Kalenz
        team_name=kalenz
        user_team_name= _ "Player"
        controller=human
        recruit={ELVES}
        {GOLD 100 100 100}
        x=42
        y=29
        [unit]
            {CLEODIL}
            find_vacant=yes
            #wmllint: recognize Cleodil
        [/unit]
    [/side]

    [event]
        name=prestart

        {FOREACH faeries i}
            [unstore_unit]
                variable=faeries[$i]
                x,y=recall,recall
            [/unstore_unit]
        {NEXT i}

        {RECALL_LOYALS}
        {CLEAR_VARIABLE faeries}
    [/event]

    [side]
        {URADREDIA}
        #wmllint: recognize Uradredia
        side=2
        team_name=kalenz
        user_team_name= _ "Player"
        recruit={ELVES}
        x=24
        y=7
    [/side]
    #wmllint: validate-on

    [side]
        {LANDAR}
        x=15
        y=38
        side=3
        canrecruit=yes
        team_name=landar
        persistent=yes
        save_id=Landar
        user_team_name= _ "Enemies"
#ifdef EASY
        recruit=Elvish Archer, Elvish Fighter
#endif
#ifdef NORMAL
        recruit=Elvish Archer, Elvish Fighter, Elvish Hero
#endif
#ifdef HARD
        recruit=Elvish Archer, Elvish Fighter, Elvish Hero, Elvish Ranger
#endif
        {GOLD 400 600 750}
        [ai]
            passive_leader=yes
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
#ifndef HARD
            recruitment_pattern=archer, fighter
#else
            recruitment_pattern=archer, fighter, mixed fighter
#endif
        [/ai]
        {INCOME 4 8 12}
    [/side]
    [side]
        side=4
        persistent=yes
        save_id=Crintil
        team_name=landar
        user_team_name= _ "Enemies"
        type=Elvish Marshal
        id=Crintil
        name=_ "Crintil"
        canrecruit=yes
        x=46
        y=39
#ifdef EASY
        recruit=Elvish Archer, Elvish Fighter
#endif
#ifdef NORMAL
        recruit=Elvish Archer, Elvish Fighter, Elvish Hero
#endif
#ifdef HARD
        recruit=Elvish Archer, Elvish Fighter, Elvish Hero, Elvish Ranger
#endif
        {INCOME 4 8 12}
        {GOLD 200 200 200}
        [ai]
            {NO_SCOUTS}
            recruitment_ignore_bad_movement=yes
#ifndef HARD
            recruitment_pattern=archer, fighter
#else
            recruitment_pattern=archer, fighter, mixed fighter
#endif
        [/ai]
    [/side]

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                description= _ "Defeat all enemy leaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Survive for six days"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Uradredia"
                condition=lose
            [/objective]
            note={EARLY_FINISH_BONUS_NOTE}
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            id=Kalenz
            message= _ "Landar, listen to me! It does not have to come to this. I know about the potion. Let us help!"
        [/message]
        [message]
            id=Landar
            message= _ "Here is Kalenz. There can be no talk with traitors! Leave none of them alive!"
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1,2
            [filter_adjacent]
                id=Landar
            [/filter_adjacent]
        [/filter]

        [message]
            id=Landar
            message= _ "Things are not going well! Retreat! We will meet again, traitors!"
        [/message]
        [endlevel]
            result=victory
        [/endlevel]
    [/event]

    [event]
        name=time over

        [message]
            id=Landar
            message= _ "We have yet to break their defenses! While we are getting weaker, the enemy is getting stronger! Retreat!"
        [/message]
        [message]
            id=Kalenz
            message= _ "We won!"
        [/message]

        [endlevel]
            result=victory
        [/endlevel]
    [/event]

    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]
