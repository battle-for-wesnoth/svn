#textdomain wesnoth-sotbe
#define GRUNT_DEFENDER X Y
    [unit]
        type=Orcish Grunt
        x={X}
        y={Y}
        side=5
        random_traits=yes
        generate_name=yes
    [/unit]
#enddef

#define ARCHER_DEFENDER X Y
    [unit]
        type=Orcish Archer
        x={X}
        y={Y}
        side=5
        random_traits=yes
        generate_name=yes
    [/unit]
#enddef

[scenario]
    id="Black_Flag"
    name= _ "Black Flag"
    map_data="{campaigns/Son_Of_The_Black_Eye/maps/Black_Flag.map}"
    {TURNS 30 25 20}

    {DEFAULT_SCHEDULE}

    next_scenario="Desert_Of_Death"
    {SCENARIO_MUSIC "vengeful.ogg"}

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Slowhand and Harman"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kapou'e"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Grüü"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    [side]
        type=Orcish Leader
        id="Kapou'e"
        name= _ "Kapou'e"
        side=1
        canrecruit=yes
        controller=human
        recruit= Wolf Rider, Orcish Grunt, Troll Whelp, Orcish Archer
        team_name=Kapoue
        user_team_name=_ "Kapou'e"
        gold=100
        {BLACK_FLAG}
    [/side]

    [side]
        type=General
        id=Slowhand
        name= _ "Slowhand"
        side=2
        team_name=Humans
        user_team_name=_"Humans"
        canrecruit=yes
        recruit=Swordsman,Fencer,Mage,Heavy Infantryman,Bowman
        [ai]
            recruitment_pattern=fighter,fighter,archer,mixed fighter
            aggression=0
            village_value=10.0
            leader_value=50.0
        [/ai]
        {GOLD 110 130 150}
    [/side]

    {STARTING_VILLAGES 2 6}

    [side]
        side=3
        no_leader=yes
        team_name=Humans
        user_team_name=_"Humans"
    [/side]

    [side]
        type=General
        id=Harman
        name= _ "Harman"
        side=4
        team_name=Humans
        user_team_name=_"Humans"
        canrecruit=yes
        recruit=Swordsman,Fencer,Mage,Heavy Infantryman,Bowman
        [ai]
            recruitment_pattern=fighter,fighter,archer,mixed fighter
            aggression=0
            village_value=10.0
            leader_value=50.0
        [/ai]
        {GOLD 80 100 150}
    [/side]

    {STARTING_VILLAGES 4 4}

    [side]
        side=5
        team_name=Kapoue
        user_team_name=_ "Kapou'e"
        no_leader=yes

        [unit]
            type=Orcish Warrior
            id=Affman
            name= _ "Affman"
            x,y=27,20
            random_traits=yes
        [/unit]
    [/side]

    [story]
        [part]
            background=sotbe2.png
            show_title=yes
            {DOT 217 156}
            {DOT 220 183}
            {DOT 232 207}
            {DOT 242 222}
            {DOT 243 250}
            {DOT 235 272}
            {DOT 227 292}
            {DOT 215 314}
            {CROSS 204 333}
        [/part]
    [/story]

    [event]
        name=prestart

        {GRUNT_DEFENDER 16 12}
        {ARCHER_DEFENDER 17 12}
        {GRUNT_DEFENDER 20 9}
        {ARCHER_DEFENDER 28 13}
        {GRUNT_DEFENDER 32 23}
        {ARCHER_DEFENDER 31 25}

        {WATCH_TOWER 21 14 Northern_Tower}
        {WATCH_TOWER 12 19 Western_Tower}
        {WATCH_TOWER 20 21 Eastern_Tower}

        [unit]
            x,y=1,30
            side=3
            id="Transport Galleon"
            type=Transport Galleon
        [/unit]

        {PIRATE_GALLEON 12 28}
        {PIRATE_GALLEON 3 22}
        {PIRATE_GALLEON 10 26}
        {PIRATE_GALLEON 6 25}

        [unit]
            side=3
            id=Lander
            id="Landing Galleon"
            name= _ "Landing Galleon"
            type=Transport Galleon
            ai_special=guardian
            x=6
            y=9
        [/unit]
    [/event]

    [event]
        name=start

        [recall]
            id=Pirk
            x=26
            y=1
        [/recall]
        [recall]
            id=Gork
            x=27
            y=1
        [/recall]
        [recall]
            id=Vraurk
            x=28
            y=1
        [/recall]

        [recall]
            id=Grüü
            x,y=25,2
        [/recall]

        [message]
            speaker="Kapou'e"
            message= _ "So, here is Tirigaz. But what in the world is going on?"
        [/message]
        [message]
            speaker="Pirk"
            message= _ "Looks like humans have attacked here too. You were right, Kapou'e, the humans have declared all-out war on us."
        [/message]
        [message]
            speaker="Kapou'e"
            message= _ "Listen, if we are going to meet with the rest of the Great Council, we have to repel this attack. You shamans hide here in the forest until we defeat them. It will be faster and easier for us if we don't have to worry about protecting you."
        [/message]
        [message]
            speaker="Gork"
            message= _ "This is a wise choice. Good luck, son of the Black-Eye."
        [/message]
        [message]
            speaker="Slowhand"
            message= _ "Haha! Our plan is going well, let's surround them on land while our allies attack them from sea!"
        [/message]
        [store_unit]
            [filter]
                id=Pirk
            [/filter]
            variable=Pirk_store
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Gork
            [/filter]
            variable=Gork_store
            kill=yes
        [/store_unit]
        [store_unit]
            [filter]
                id=Vraurk
            [/filter]
            variable=Vraurk_store
            kill=yes
        [/store_unit]
    [/event]

    [event]
        name=turn 2

        [message]
            speaker=Affman
            message= _ "Look, a party of our kind approaches from the North."
        [/message]

        [message]
            speaker="Kapou'e"
            message= _ "Greetings from Kapou'e, Son of the Black-Eye Karun."
        [/message]

        [message]
            speaker=Affman
            message= _ "Son of the great Black-Eye Karun?! You do us honor, Chief."
        [/message]

        [message]
            speaker="Kapou'e"
            message= _ "Do not grovel, just tell me what's going on here."
        [/message]

        [message]
            speaker=Affman
            message= _ "I don't really know, one day all was calm and peaceful and the next a fleet of human ships showed up and began spewing out human-worms. We tried to hold them off as best we could, but they captured the Northern keep. And then human reinforcements arrived from their settlements to the South."
        [/message]

        [message]
            speaker="Kapou'e"
            message= _ "Are the shamans safe?"
        [/message]

        [message]
            speaker=Affman
            message= _ "When we realized that there was no way we could hold the humans off, we sent them East to a place near the Mourned Hills along with most of our women and children. The rest of us remained here to buy them some time."
        [/message]

        [message]
            speaker="Kapou'e"
            message= _ "Wise decision. We have actually come to speak to the shamans, but while we are here we must help our brothers in need. Grüü, help hold them while I run to the keep and organize our forces to counterattack. We can't defeat them by sea without naval forces, but we can destroy the foothold they have gained on the land."
        [/message]

        [message]
            speaker="Grüü"
            message= _ "I love this strategy, Chief!"
        [/message]
    [/event]

    [event]
        name=turn 4

        # add a warning about the transport galleon and the landing party here
        #[message]
        #    speaker="Grüü"
        #    message= _ ""
        #[/message]
    [/event]

    # this event makes the transport galleon try to sail to the sandy coastline
    # near the orcish castle to unload the attackers

    [event]
        name=turn refresh
        first_time_only=no

        [if]
            [variable]
                name=side_number
                equals=3
            [/variable]

            [then]
                [store_unit]
                    [filter]
                        id=Transport Galleon
                    [/filter]

                    kill=yes
                    variable=stored_transport
                [/store_unit]

                [if]
                    [variable]
                        name=landing_spot_picked
                        equals=yes
                    [/variable]

                    [variable]
                        name=transport_landed
                        not_equals=yes
                    [/variable]

                    [then]
                        {VARIABLE stored_transport.goto_x $transport_destination_x}
                        {VARIABLE stored_transport.goto_y $transport_destination_y}

                        [unstore_unit]
                            variable=stored_transport
                        [/unstore_unit]
                    [/then]

                    [else]
                        {VARIABLE stored_transport.goto_x 25}
                        {VARIABLE stored_transport.goto_y 27}

                        [unstore_unit]
                            variable=stored_transport
                        [/unstore_unit]
                    [/else]
                [/if]

                {CLEAR_VARIABLE stored_transport}
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            id=Transport Galleon
            x,y=25,27
        [/filter]

        [store_locations]
            x=21-30
            y=23-29
            terrain=Ww

            [filter_adjacent_location]
                terrain=Ds
            [/filter_adjacent_location]

            [not]
                [filter]
                [/filter]
            [/not]

            variable=possible_transport_destinations
        [/store_locations]

        {VARIABLE_OP transport_destination_index random "1..$possible_transport_destinations.length"}
        {VARIABLE_OP transport_destination_index add -1}

        {VARIABLE transport_destination_x $possible_transport_destinations[$transport_destination_index].x}
        {VARIABLE transport_destination_y $possible_transport_destinations[$transport_destination_index].y}

        {VARIABLE landing_spot_picked yes}

        {CLEAR_VARIABLE possible_transport_destinations,transport_destination_index}
    [/event]

    [event]
        name=moveto

        [filter]
            id=Transport Galleon

            [filter_location]
                terrain=Ww

                [filter_adjacent_location]
                    terrain=Ds
                [/filter_adjacent_location]
            [/filter_location]
        [/filter]

        {VARIABLE transport_landed yes}
        {CLEAR_VARIABLE transport_destination}

        [unit]
            id="J'rem"
            type=Fencer
            x,y=$x1,$y1
            side=3
            name= _ "J'rem"
            random_traits=yes
        [/unit]
        [unit]
            type=Fencer
            x,y=$x1,$y1
            side=3
            generate_name=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Swordsman
            x,y=$x1,$y1
            side=3
            generate_name=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Mage
            x,y=$x1,$y1
            side=3
            generate_name=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Cavalryman
            x,y=$x1,$y1
            side=3
            generate_name=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Cavalryman
            x,y=$x1,$y1
            side=3
            generate_name=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Cavalryman
            x,y=$x1,$y1
            side=3
            generate_name=yes
            random_traits=yes
        [/unit]
        [message]
            id="J'rem"
            message= _ "Pillage! Let's plunder these orcs!"
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=Slowhand
        [/filter]
        [message]
            speaker=unit
            message= _ "Aaaargh! I die!"
        [/message]
        [message]
            speaker="Kapou'e"
            message= _ "Finally, you pay for what you did to my orc brothers!"
        [/message]
    [/event]

    [event]
        name=victory

        [message]
            speaker="Kapou'e"
            message= _ "We are victorious at last. Someone go tell the shamans that they can come out now."
        [/message]

        [unstore_unit]
            variable=Pirk_store
            find_vacant=yes
        [/unstore_unit]
        [unstore_unit]
            variable=Gork_store
            find_vacant=yes
        [/unstore_unit]
        [unstore_unit]
            variable=Vraurk_store
            find_vacant=yes
        [/unstore_unit]

        {CLEAR_VARIABLE Pirk_store}
        {CLEAR_VARIABLE Gork_store}
        {CLEAR_VARIABLE Vraurk_store}

        [message]
            speaker=Gork
            message= _ "Congratulations on your victory, Kapou'e. You do honor to the memory of your father."
        [/message]
        [message]
            speaker="Kapou'e"
            message= _ "Thanks, but I have news. Since the forces here were certain they were going to be defeated, they sent the shamans to the Mourned Hills. If we want to meet them, we must go after them."
        [/message]
        [message]
            speaker=Pirk
            message= _ "Oh, great. That means we have to cross the Desert of Death which is full of poisonous giant scorpions and outlaws. And bypassing it would take ages! Not to mention after this desert, we'll have to cross the Silent Forest!"
        [/message]
        [message]
            speaker=Grüü
            message= _ "Well, we have no choice ... I've never tasted scorpions but I am sure they are good. This journey promises to be fun."
        [/message]
        [kill]
            id=Eastern_Tower
        [/kill]
        [kill]
            id=Northern_Tower
        [/kill]
        [kill]
            id=Western_Tower
        [/kill]
    [/event]

    {@campaigns/Son_Of_The_Black_Eye/utils/deaths.cfg}
[/scenario]
