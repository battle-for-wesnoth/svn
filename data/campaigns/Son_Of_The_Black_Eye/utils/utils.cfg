#textdomain wesnoth-sotbe

#define OLD_ORCISH_SHAMAN X Y ID_STRING NAME_STRING
    [unit]
        id={ID_STRING}
        name={NAME_STRING}
        type=Old Orcish Shaman
        profile=portraits/old_orcish_shaman.png
        side=1
        x={X}
        y={Y}
        random_traits=no
        {IS_HERO}
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]
#enddef

#define NOVICE_ORCISH_SHAMAN X Y ID_STRING NAME_STRING
    [unit]
        id={ID_STRING}
        name={NAME_STRING}
        type=Novice Orcish Shaman
        profile=portraits/young_orcish_shaman.png
        side=1
        x={X}
        y={Y}
        random_traits=no
        {IS_HERO}
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]
#enddef

#define ORCISH_SHAMAN X Y ID_STRING NAME_STRING
    [unit]
        id={ID_STRING}
        name={NAME_STRING}
        type=Orcish Shaman
        profile=portraits/orcish_shaman.png
        side=1
        x={X}
        y={Y}
        random_traits=no
        {IS_HERO}
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]
#enddef

#define BLACK_FLAG
    flag=flags/black-flag-1.png:100,flags/black-flag-2.png:300,flags/black-flag-1.png:100,flags/black-flag-3.png:300
    flag_icon=flags/black-flag-icon.png
#enddef

#define RENAME_IF_DEAD VAR NAME STRING
    [if]
        [variable]
            name={VAR}
            equals=yes
        [/variable]
        [then]
            {MODIFY_UNIT id={NAME} name {STRING}}
        [/then]
    [/if]
#enddef

#define GOT_THE_GREAT_HORDE SIDES
    [event]
        name=prerecruit
        first_time_only=no

        [filter]
            side={SIDES}
        [/filter]

        {VARIABLE unit.upkeep $unit.level}
        {VARIABLE_OP unit.upkeep add -1}
        {VARIABLE unit.variables.great_horde_upkeep_mod_applied yes}

        [unstore_unit]
            variable=unit
            find_vacant=no
        [/unstore_unit]
    [/event]

    [event]
        name=prerecall
        first_time_only=no

        [filter]
            side={SIDES}

            [not]
                [filter_wml]
                    [modifications]
                        [trait]
                            id=loyal
                        [/trait]
                    [/modifications]
                [/filter_wml]
            [/not]

            [not]
                [filter_wml]
                    [variables]
                        great_horde_upkeep_mod_applied=yes
                    [/variables]
                [/filter_wml]
            [/not]
        [/filter]

        {VARIABLE unit.upkeep $unit.level}
        {VARIABLE_OP unit.upkeep add -1}
        {VARIABLE unit.variables.great_horde_upkeep_mod_applied yes}

        [unstore_unit]
            variable=unit
            find_vacant=no
        [/unstore_unit]
    [/event]

    [event]
        name=post_advance
        first_time_only=no

        [filter]
            side={SIDES}

            [not]
                [filter_wml]
                    [modifications]
                        [trait]
                            id=loyal
                        [/trait]
                    [/modifications]
                [/filter_wml]
            [/not]
        [/filter]

        {VARIABLE unit.upkeep $unit.level}
        {VARIABLE_OP unit.upkeep add -1}
        {VARIABLE unit.variables.great_horde_upkeep_mod_applied yes}

        [unstore_unit]
            variable=unit
            find_vacant=no
        [/unstore_unit]
    [/event]
#enddef

# This is commented out because it seems to incur a little delay at turn start
# yet it's not actually used (the player or allies don't get any units spawned
# for them in the final scenarios). Belongs to the above macro.
#ifdef __UNUSED
    [event]
        name=side turn
        first_time_only=no

        {VARIABLE great_horde_sides {SIDES}}

        [if]
            [variable]
                name=great_horde_sides
                contains=$side_number
            [/variable]

            [then]
                [store_unit]
                    [filter]
                        side={SIDES}
                        x,y=1-99,1-99

                        [not]
                            canrecruit=yes
                        [/not]

                        [not]
                            [filter_wml]
                                [modifications]
                                    [trait]
                                        id=loyal
                                    [/trait]
                                [/modifications]
                            [/filter_wml]
                        [/not]

                        [not]
                            [filter_wml]
                                [variables]
                                    great_horde_upkeep_mod_applied=yes
                                [/variables]
                            [/filter_wml]
                        [/not]
                    [/filter]

                    kill=yes
                    variable=great_horde_units
                [/store_unit]

                {FOREACH great_horde_units i}
                    {VARIABLE great_horde_units[$i].upkeep $great_horde_units[$i].level}
                    {VARIABLE_OP great_horde_units[$i].upkeep add -1}
                    {VARIABLE great_horde_units[$i].variables.great_horde_upkeep_mod_applied yes}

                    [unstore_unit]
                        variable=great_horde_units[$i]
                    [/unstore_unit]
                {NEXT i}

                {CLEAR_VARIABLE great_horde_units}
            [/then]
        [/if]
    [/event]
#endif