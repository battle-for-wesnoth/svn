
#define TERRAIN_TYPES
"KCDuWFfmHhVSvtgrRd\/|YwipZcs~ "
#enddef

#define TERRAIN_BASE_PROBABILITY LETTER IMAGE PROBABILITY
[terrain_graphics]
	[tile]
		x=0
		y=0
		type="{LETTER}"
		[image]
			z_index=-99
			name={IMAGE}
		[/image]
	[/tile]
	
	probability={PROBABILITY}
	no_flag="terrain-{LETTER}"
	set_flag="terrain-{LETTER}"
[/terrain_graphics]
#enddef

#define TERRAIN_BASE LETTER IMAGE
{TERRAIN_BASE_PROBABILITY ({LETTER}) {IMAGE} 100}
#enddef

#define TERRAIN_ADJACENT_4 LETTERS IMAGE
[terrain_graphics]
	
	map="
  2
.   3 
  1
.   4
  5
"
	[tile]
		pos=1
		type=!{LETTERS}

		[no_flag]
			name=transition-@R0
		[/no_flag]
		[no_flag]
			name=transition-@R1
		[/no_flag]
		[no_flag]
			name=transition-@R2
		[/no_flag]
		[no_flag]
			name=transition-@R3
		[/no_flag]
		[set_flag]
			name=transition-@R0
		[/set_flag]
		[set_flag]
			name=transition-@R1
		[/set_flag]
		[set_flag]
			name=transition-@R2
		[/set_flag]
		[set_flag]
			name=transition-@R3
		[/set_flag]

		[image]
			z_index=-98
			name={IMAGE}-@R0-@R1-@R2-@R3
		[/image]
	[/tile]
	[tile]
		pos=2
		type={LETTERS}
		no_flag=transition-@R3
		set_flag=transition-@R3
	[/tile]
	[tile]
		pos=3
		type={LETTERS}
		no_flag=transition-@R4
		set_flag=transition-@R4
	[/tile]
	[tile]
		pos=4
		type={LETTERS}
		no_flag=transition-@R5
		set_flag=transition-@R5
	[/tile]
	[tile]
		pos=5
		type={LETTERS}
		no_flag=transition-@R0
		set_flag=transition-@R0
	[/tile]

	rotations=n,ne,se,s,sw,nw
[/terrain_graphics]
#enddef

#define TERRAIN_ADJACENT_3 LETTERS IMAGE
[terrain_graphics]
	map="
  2
.   3 
  1
.   4
  .
"
	[tile]
		pos=1
		type=!{LETTERS}

		[no_flag]
			name=transition-@R0
		[/no_flag]
		[no_flag]
			name=transition-@R1
		[/no_flag]
		[no_flag]
			name=transition-@R2
		[/no_flag]
		[set_flag]
			name=transition-@R0
		[/set_flag]
		[set_flag]
			name=transition-@R1
		[/set_flag]
		[set_flag]
			name=transition-@R2
		[/set_flag]

		[image]
			z_index=-98
			name={IMAGE}-@R0-@R1-@R2
		[/image]
	[/tile]
	[tile]
		pos=2
		type={LETTERS}
		no_flag=transition-@R3
		set_flag=transition-@R3
	[/tile]
	[tile]
		pos=3
		type={LETTERS}
		no_flag=transition-@R4
		set_flag=transition-@R4
	[/tile]
	[tile]
		pos=4
		type={LETTERS}
		no_flag=transition-@R5
		set_flag=transition-@R5
	[/tile]

	rotations=n,ne,se,s,sw,nw
[/terrain_graphics]
#enddef

#define TERRAIN_ADJACENT_2 LETTERS IMAGE
[terrain_graphics]
	map="
  2
.   3 
  1
.   .
  .
"
	[tile]
		pos=1
		type=!{LETTERS}

		[no_flag]
			name=transition-@R0
		[/no_flag]
		[no_flag]
			name=transition-@R1
		[/no_flag]
		[set_flag]
			name=transition-@R0
		[/set_flag]
		[set_flag]
			name=transition-@R1
		[/set_flag]

		[image]
			z_index=-98
			name={IMAGE}-@R0-@R1
		[/image]
	[/tile]
	[tile]
		pos=2
		type={LETTERS}
		no_flag=transition-@R3
		set_flag=transition-@R3
	[/tile]
	[tile]
		pos=3
		type={LETTERS}
		no_flag=transition-@R4
		set_flag=transition-@R4
	[/tile]

	rotations=n,ne,se,s,sw,nw
[/terrain_graphics]
#enddef

#define TERRAIN_ADJACENT_1 LETTERS IMAGE
[terrain_graphics]
	
	map="
  2
.   . 
  1
.   .
  .
"
	[tile]
		pos=1
		type=!{LETTERS}

		[no_flag]
			name=transition-@R0
		[/no_flag]
		[set_flag]
			name=transition-@R0
		[/set_flag]

		[image]
			z_index=-98
			name={IMAGE}-@R0
		[/image]
	[/tile]
	[tile]
		pos=2
		type={LETTERS}
		no_flag=transition-@R3
		set_flag=transition-@R3
	[/tile]

	rotations=n,ne,se,s,sw,nw
[/terrain_graphics]
#enddef

#define TERRAIN_ADJACENT_1234 LETTERS IMAGE
{TERRAIN_ADJACENT_4 ({LETTERS}) {IMAGE}}
{TERRAIN_ADJACENT_3 ({LETTERS}) {IMAGE}}
{TERRAIN_ADJACENT_2 ({LETTERS}) {IMAGE}}
{TERRAIN_ADJACENT_1 ({LETTERS}) {IMAGE}}
#enddef

#define TERRAIN_ADJACENT_123 LETTERS IMAGE
{TERRAIN_ADJACENT_3 ({LETTERS}) {IMAGE}}
{TERRAIN_ADJACENT_2 ({LETTERS}) {IMAGE}}
{TERRAIN_ADJACENT_1 ({LETTERS}) {IMAGE}}
#enddef

#define TERRAIN_ADJACENT_12 LETTERS IMAGE
{TERRAIN_ADJACENT_2 ({LETTERS}) {IMAGE}}
{TERRAIN_ADJACENT_1 ({LETTERS}) {IMAGE}}
#enddef

#define TERRAIN_ADJACENT_NORTH LETTERS IMAGE
[terrain_graphics]
	map="
  2
.   .
  1
"
	[tile]
		pos=2
		type=!{LETTERS}	
		no_flag=transition-s
		set_flag=transition-s
		[image]
			z_index=-99
			name={IMAGE}-s
		[/image]
	[/tile]
	[tile]
		no_flag=transition-n
		set_flag=transition-n
		pos=1
		type={LETTERS}
	[/tile]
[/terrain_graphics]

[terrain_graphics]
	map="
  .
2   .
  1
"
	[tile]
		pos=2
		type=!{LETTERS}	
		no_flag=transition-se
		set_flag=transition-se
		[image]
			z_index=-99
			name={IMAGE}-se
		[/image]
	[/tile]
	[tile]
		no_flag=transition-nw
		set_flag=transition-nw
		pos=1
		type={LETTERS}
	[/tile]
[/terrain_graphics]

[terrain_graphics]
	map="
  .
.   2
  1
"
	[tile]
		pos=2
		type=!{LETTERS}	
		no_flag=transition-sw
		set_flag=transition-sw
		[image]
			z_index=-99
			name={IMAGE}-sw
		[/image]
	[/tile]
	[tile]
		no_flag=transition-ne
		set_flag=transition-ne
		pos=1
		type={LETTERS}
	[/tile]
[/terrain_graphics]
#enddef

#define DISABLE_TRANSITIONS LETTER
[terrain_graphics]
	map="
  1
6   2
  7
5   3
  4
"
	[tile]
		pos=1
		set_flag=transition-s
	[/tile]
	[tile]
		pos=2
		set_flag=transition-sw
	[/tile]
	[tile]
		pos=3
		set_flag=transition-nw
	[/tile]
	[tile]
		pos=4
		set_flag=transition-n
	[/tile]
	[tile]
		pos=5
		set_flag=transition-ne
	[/tile]
	[tile]
		pos=6
		set_flag=transition-se
	[/tile]
	[tile]
		pos=7
		type={LETTER}
	[/tile]
[/terrain_graphics]
#enddef

#define CASTLE_WALLS CASTLE NOTCASTLE IMAGE
{DISABLE_TRANSITIONS {CASTLE}}

[terrain_graphics]
	map="
2
  2
1"
	[tile]
		pos=1
		type={NOTCASTLE}
	[/tile]
	[tile]
		pos=2
		type={CASTLE}
	[/tile]

	[image]
		z_index=-1
		name="{IMAGE}-bg-concave-@R0"
	[/image]
	[image]
		z_index=1
		name="{IMAGE}-fg-concave-@R0"
	[/image]
	rotations=ne,e,se,sw,w,nw
[/terrain_graphics]

[terrain_graphics]
	map="
1
  1
2"
	[tile]
		pos=1
		type={NOTCASTLE}
	[/tile]
	[tile]
		pos=2
		type={CASTLE}
	[/tile]

	[image]
		z_index=-1
		name="{IMAGE}-bg-convex-@R0"
	[/image]
	[image]
		z_index=1
		name="{IMAGE}-fg-convex-@R0"
	[/image]
	rotations=ne,e,se,sw,w,nw
[/terrain_graphics]
#enddef

#define CASTLE_AND_KEEP CASTLE KEEP CASTLE_IMAGE KEEP_IMAGE
{CASTLE_WALLS {CASTLE} !{CASTLE}{KEEP} {CASTLE_IMAGE}}
{DISABLE_TRANSITIONS {KEEP}}

[terrain_graphics]
	map="
2
  2
1"
	[tile]
		pos=1
		type={KEEP}
	[/tile]
	[tile]
		pos=2
		type={CASTLE}
	[/tile]

	[image]
		z_index=-1
		name="{KEEP_IMAGE}-bg-inside-@R0"
	[/image]
	[image]
		z_index=1
		name="{KEEP_IMAGE}-fg-inside-@R0"
	[/image]
	rotations=ne,e,se,sw,w,nw
[/terrain_graphics]

[terrain_graphics]
	map="
3
  3
1"
	[tile]
		pos=1
		type={KEEP}
	[/tile]
	[tile]
		pos=3
		type=!{CASTLE}{KEEP}
	[/tile]

	[image]
		z_index=-1
		name="{KEEP_IMAGE}-bg-wall-@R0"
	[/image]
	[image]
		z_index=1
		name="{KEEP_IMAGE}-fg-wall-@R0"
	[/image]
	rotations=ne,e,se,sw,w,nw
[/terrain_graphics]

[terrain_graphics]
	map="
2
  3
1"

	[tile]
		pos=1
		type={KEEP}
	[/tile]
	[tile]
		pos=2
		type={CASTLE}
	[/tile]
	[tile]
		pos=3
		type=!{CASTLE}{KEEP}
	[/tile]

	[image]
		z_index=-1
		name="{KEEP_IMAGE}-bg-wall-0-@R0"
	[/image]
	[image]
		z_index=1
		name="{KEEP_IMAGE}-fg-wall-0-@R0"
	[/image]
	rotations=ne,e,se,sw,w,nw
[/terrain_graphics]

[terrain_graphics]
	map="
3
  2
1"

	[tile]
		pos=1
		type={KEEP}
	[/tile]
	[tile]
		pos=2
		type={CASTLE}
	[/tile]
	[tile]
		pos=3
		type=!{CASTLE}{KEEP}
	[/tile]
	[image]
		z_index=-1
		name="{KEEP_IMAGE}-bg-wall-1-@R0"
	[/image]
	[image]
		z_index=1
		name="{KEEP_IMAGE}-fg-wall-1-@R0"
	[/image]
	rotations=ne,e,se,sw,w,nw
[/terrain_graphics]
#enddef

#
# Attachs graphics to each known terrain types
#

{TERRAIN_BASE K keep}
{TERRAIN_BASE C castle}
{TERRAIN_BASE D flag-cave-neutral}
{TERRAIN_BASE u cave}
{TERRAIN_BASE W cavewall}
{TERRAIN_BASE F snow-forest}
{TERRAIN_BASE f forest}
{TERRAIN_BASE m mountains}
{TERRAIN_BASE H snow-hills}
{TERRAIN_BASE_PROBABILITY h hills-variation1 15}
{TERRAIN_BASE_PROBABILITY h hills-variation2 15}
{TERRAIN_BASE_PROBABILITY h hills-variation3 30}
{TERRAIN_BASE h hills}
{TERRAIN_BASE_PROBABILITY S snow2 30}
{TERRAIN_BASE_PROBABILITY S snow3 30}
{TERRAIN_BASE S snow}
{TERRAIN_BASE V flag-snow-neutral}
{TERRAIN_BASE v human-village}
{TERRAIN_BASE t flag-neutral}
{TERRAIN_BASE_PROBABILITY g grassland-rocks 4}
{TERRAIN_BASE_PROBABILITY g grassland-flowers 8}
{TERRAIN_BASE g grassland}
{TERRAIN_BASE r dirt}
{TERRAIN_BASE R road}
{TERRAIN_BASE_PROBABILITY d desert-plant 10}
{TERRAIN_BASE d desert}
{TERRAIN_BASE \ bridge-se-nw}
{TERRAIN_BASE / bridge-ne-sw}
{TERRAIN_BASE | bridge-n-s}
{TERRAIN_BASE Y flag-swampwater-neutral}
{TERRAIN_BASE_PROBABILITY w swampwater2 30}
{TERRAIN_BASE_PROBABILITY w swampwater3 30}
{TERRAIN_BASE w swampwater}
{TERRAIN_BASE i ice}
{TERRAIN_BASE p pier}
{TERRAIN_BASE c coast}
{TERRAIN_BASE s ocean}
{TERRAIN_BASE Z flag-coast-neutral}
{TERRAIN_BASE ~ fog}
{TERRAIN_BASE ( ) void}

#
# Transition between terrains
#

# Special transitions go first

# Castle and keeps
{CASTLE_AND_KEEP C K castle keep}

# Forest, hills and mountains should always overlay on northern sides
{TERRAIN_ADJACENT_NORTH m mountains}
{TERRAIN_ADJACENT_NORTH H snow-hills}
{TERRAIN_ADJACENT_NORTH h hills}
{TERRAIN_ADJACENT_NORTH F snow-forest}
{TERRAIN_ADJACENT_NORTH f forest}

# Then, standard transitions
{TERRAIN_ADJACENT_1234 uD cave}
{TERRAIN_ADJACENT_1 F snow-forest}
{TERRAIN_ADJACENT_1 f forest}
{TERRAIN_ADJACENT_1 m mountains}
{TERRAIN_ADJACENT_12 H snow-hills}
{TERRAIN_ADJACENT_12 h hills}
{TERRAIN_ADJACENT_1234 SV snow}
{TERRAIN_ADJACENT_1234 tvg grassland}
{TERRAIN_ADJACENT_1 r dirt}
{TERRAIN_ADJACENT_1 R road}	# Graphics do not seem to be here
{TERRAIN_ADJACENT_1 d desert}
{TERRAIN_ADJACENT_1 Yw swampwater}
{TERRAIN_ADJACENT_1 i ice}
{TERRAIN_ADJACENT_1 cZp\|/ coast}
{TERRAIN_ADJACENT_1 s ocean}
{TERRAIN_ADJACENT_1234 ~ fog}
{TERRAIN_ADJACENT_1234 ( ) void}


# Some test cases

#[terrain_graphics]
#	map="
#.   1
#  .
#.   1
#  .
#.   1
#  1
#1"
#	[tile]
#		pos=1
#		type=m
#	[/tile]
#
#	probability=30
#	no_flag="built-m"
#	set_flag="built-m"
#	
#	image_background="mountains-test"
#[/terrain_graphics]

#[terrain_graphics]
#	[tile]
#		x=0
#		y=0
#		type=m
#		[image]
#			z_index=-1
#			name="mountains-test-2"
#		[/image]
#	[/tile]
#	# probability=20
#	no_flag="built-m"
#	set_flag="built-m"
#	# image_background="mountains-test-2"
#
#	precedence=2
#[/terrain_graphics]
#
#
#[terrain_graphics]
#	terrains=mgcw
#
#	[tile]
#		x=0
#		y=0
#		type="@"
#	[/tile]
#	[tile]
#		x=1
#		y=1
#		type="po@ual"
#	[/tile]
#
#	no_flag="built-@T"
#	set_flag="built-@T"
#
#	precedence=3
#[/terrain_graphics]


# A stupid test case, just to demonstrate the has_flag condition

#[terrain_graphics]
#
#	[tile]
#		x=0
#		y=0
#		type=C
#		set_flag=moo
#	[/tile]
#
#[/terrain_graphics]
#
#[terrain_graphics]
#	[tile]
#		x=0
#		y=0
#		type=C
#	[/tile]
#	[tile]
#		x=0
#		y=1
#		type=*
#		has_flag="moo"
#	[/tile]
#	image_background=schmurgle
#[/terrain_graphics]
